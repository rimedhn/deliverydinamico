<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Deliverys</title>
    <link id="favicon" rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçï</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="bg-red-600 text-white py-4 mb-6">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div id="logo-container" class="hidden">
                        <img id="logo-negocio" src="" alt="Logo" class="w-12 h-12 md:w-16 md:h-16 rounded-full object-cover">
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold">üöö Sistema de Deliverys</h1>
                        <p class="mt-2 text-red-100" id="header-slogan">Los mejores sabores a tu puerta</p>
                    </div>
                </div>
                
                <!-- Botones de navegaci√≥n -->
                <div class="flex items-center space-x-4">
                    <button id="btn-compartir" onclick="compartirEnlace()" class="hidden bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-md text-sm font-medium transition duration-300">
                        üì§ Compartir
                    </button>
                    <button id="btn-login" onclick="mostrarLogin()" class="bg-gray-700 hover:bg-gray-800 px-4 py-2 rounded-md text-sm font-medium transition duration-300">
                        üë§ Admin
                    </button>
                    <button id="btn-logout" onclick="cerrarSesion()" class="hidden bg-red-700 hover:bg-red-800 px-4 py-2 rounded-md text-sm font-medium transition duration-300">
                        üö™ Salir
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal de Login -->
    <div id="modal-login" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="bg-red-600 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold">üîê Iniciar Sesi√≥n</h3>
                <button onclick="cerrarLogin()" class="text-white hover:text-gray-200 text-xl">√ó</button>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Usuario:</label>
                        <input type="text" id="input-usuario" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Ingresa tu usuario">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a:</label>
                        <input type="password" id="input-clave" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Ingresa tu contrase√±a">
                    </div>
                    <button onclick="validarLogin()" class="w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700 transition duration-300">
                        Ingresar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 md:p-6 lg:p-8">
        <!-- Vista de Deliverys (Solo Admin) -->
        <div id="vista-deliverys" class="hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">üöö Gesti√≥n de Deliverys</h2>
            <div id="deliverys-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Los deliverys se cargar√°n din√°micamente -->
            </div>
        </div>

        <!-- Carrusel de Promociones -->
        <div id="seccion-promociones" class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üéâ Promociones Especiales</h2>
            <div class="relative overflow-hidden rounded-lg">
                <div id="carrusel-promociones" class="flex transition-transform duration-500 ease-in-out">
                    <!-- Las promociones se cargar√°n din√°micamente -->
                </div>
                
                <!-- Controles del carrusel -->
                <button onclick="cambiarSlide(-1)" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition duration-300">
                    &#8249;
                </button>
                <button onclick="cambiarSlide(1)" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition duration-300">
                    &#8250;
                </button>
                
                <!-- Indicadores -->
                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                    <!-- Los indicadores se generar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Filtros de categor√≠as de negocios -->
        <div id="seccion-filtros" class="mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Categor√≠as</h2>
            <div class="flex flex-wrap gap-2" id="filtros-categorias">
                <!-- Las categor√≠as se cargar√°n din√°micamente -->
            </div>
        </div>

        <!-- Grid de negocios -->
        <div id="negocios-container">
            <!-- Los negocios se cargar√°n din√°micamente -->
        </div>

        <!-- Grid de productos (cuando se selecciona un negocio) -->
        <div id="productos-container" class="hidden">
            <!-- Los productos se cargar√°n din√°micamente organizados por categor√≠as -->
        </div>

        <!-- Breadcrumb de navegaci√≥n -->
        <div id="breadcrumb" class="hidden mb-6 text-sm text-gray-600">
            <span onclick="volverANegocios()" class="cursor-pointer hover:text-red-600">üè† Negocios</span>
            <span id="breadcrumb-negocio"></span>
        </div>
    </div>

    <!-- Botones flotantes -->
    <!-- Bot√≥n del carrito -->
    <button id="carrito-flotante" onclick="abrirModal()" class="fixed bottom-20 right-4 bg-red-600 text-white p-4 rounded-full shadow-lg hover:bg-red-700 transition duration-300 z-40 hidden">
        <div class="relative">
            üõí
            <span id="contador-carrito" class="absolute -top-5 -right-5 bg-yellow-400 text-black text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold">0</span>
        </div>
    </button>

    <!-- Bot√≥n de WhatsApp -->
    <a id="whatsapp-flotante" href="#" target="_blank" class="fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition duration-300 z-40">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
        </svg>
    </a>

    <!-- Modal del carrito -->
    <div id="modal-carrito" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] flex flex-col">
            <!-- Header del modal -->
            <div class="bg-red-600 text-white p-3 flex justify-between items-center flex-shrink-0">
                <h3 class="text-lg font-bold">üõí Tu Pedido</h3>
                <div class="flex items-center space-x-2">
                    <button onclick="vaciarCarrito()" class="bg-red-700 hover:bg-red-800 px-3 py-1 rounded text-sm transition duration-300">
                        Vaciar
                    </button>
                    <button onclick="cerrarModal()" class="bg-red-700 hover:bg-red-800 px-3 py-1 rounded text-sm transition duration-300">
                        Cerrar
                    </button>
                </div>
            </div>
            
            <!-- Contenido del carrito (scrollable) -->
            <div class="p-4 flex-1 overflow-y-auto">
                <div id="items-carrito-modal" class="space-y-3 mb-4"></div>
                <div id="carrito-vacio" class="text-center py-8 text-gray-500">
                    Tu carrito est√° vac√≠o
                </div>
            </div>
            
            <!-- Footer del modal (fixed) -->
            <div id="footer-carrito" class="border-t p-3 flex-shrink-0 hidden">
                <div class="flex justify-between items-center text-base font-bold mb-3">
                    <span>Total:</span>
                    <span id="total-carrito-modal">LPS. 0.00</span>
                </div>
                
                <!-- Formulario de datos del cliente -->
                <div class="mb-3 space-y-2">
                    <!-- Tipo de pedido -->
                    <select id="tipo-pedido" onchange="actualizarCamposFormulario()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-sm">
                        <option value="domicilio">üöö Env√≠o a domicilio</option>
                        <option value="llevar">ü•° Para llevar</option>
                        <option value="restaurante">üçΩÔ∏è Comer en restaurante</option>
                    </select>
                    
                    <!-- Nombre (siempre obligatorio) -->
                    <input type="text" id="nombre-cliente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-sm" placeholder="Tu nombre completo *">
                    
                    <!-- Tel√©fono (obligatorio para domicilio y llevar) -->
                    <div id="campo-telefono">
                        <input type="tel" id="telefono-cliente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-sm" placeholder="Tu n√∫mero de tel√©fono *">
                    </div>
                    
                    <!-- Direcci√≥n (solo para domicilio) -->
                    <div id="campo-direccion">
                        <textarea id="direccion-cliente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-sm" rows="2" placeholder="Tu direcci√≥n completa *"></textarea>
                    </div>
                    
                    <!-- N√∫mero de mesa (solo para restaurante) -->
                    <div id="campo-mesa" class="hidden">
                        <input type="number" id="mesa-cliente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-sm" placeholder="N√∫mero de mesa (opcional)" min="1">
                    </div>
                </div>
                
                <!-- Checkbox para notificar al comercio -->
                <div class="mb-3">
                    <label class="flex items-center">
                        <input type="checkbox" id="notificar-comercio" checked class="mr-2">
                        <span class="text-sm text-gray-700">Tambi√©n notificar al comercio</span>
                    </label>
                </div>
                
                <button onclick="enviarPorWhatsApp()" class="w-full px-4 py-2 bg-green-500 text-white font-semibold rounded-md hover:bg-green-600 transition duration-300 flex items-center justify-center text-sm">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                    </svg>
                    Enviar Pedido al Delivery
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold mb-4">¬°S√≠guenos en nuestras redes sociales!</h3>
                <div class="flex justify-center space-x-6" id="redes-sociales">
                    <!-- Las redes sociales se cargar√°n din√°micamente -->
                </div>
            </div>
            
            <div class="text-center border-t border-gray-600 pt-4">
                <p>&copy; 2024 Sistema de Deliverys. Todos los derechos reservados.</p>
                <p class="text-gray-400 mt-2" id="footer-contacto">
                    üìû Tel√©fono: (504) 2234-5678 | üìß Email: info@deliverys.com
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Variables globales
        let carrito = [];
        let total = 0;
        let categoriaActual = 'todas';
        let slideActual = 0;
        let totalSlides = 0;
        let usuarioActual = null;
        let deliveryActual = null;
        let negocioActual = null;
        let vistaActual = 'negocios'; // 'deliverys', 'negocios', 'productos'
        
        // Variables para datos din√°micos
        let deliverys = [];
        let negocios = [];
        let categoriasNegocios = [];
        let categorias = [];
        let promociones = [];
        let productos = [];
        let opciones = [];
        let tiposOpciones = [];
        let usuarios = [];
        
        // ID del Google Sheets
        const SHEET_ID = '1ApDsUMZCzHacOcpn6HtmxDsIyeae5osK6StuZP9PQxE';
        
        // URLs de OpenSheets API
        const API_URLS = {
            deliverys: `https://opensheet.elk.sh/${SHEET_ID}/Deliverys`,
            negocios: `https://opensheet.elk.sh/${SHEET_ID}/Negocios`,
            categoriasNegocios: `https://opensheet.elk.sh/${SHEET_ID}/CategoriasNegocios`,
            categorias: `https://opensheet.elk.sh/${SHEET_ID}/Categorias`,
            promociones: `https://opensheet.elk.sh/${SHEET_ID}/Promociones`,
            productos: `https://opensheet.elk.sh/${SHEET_ID}/Productos`,
            opciones: `https://opensheet.elk.sh/${SHEET_ID}/Opciones`,
            tiposOpciones: `https://opensheet.elk.sh/${SHEET_ID}/TiposOpciones`,
            usuarios: `https://opensheet.elk.sh/${SHEET_ID}/Usuarios`
        };

        // Funci√≥n principal para cargar todos los datos
        async function cargarDatosCompletos() {
            try {
                mostrarCargando(true);
                
                // Cargar todos los datos en paralelo
                const [deliverysData, negociosData, categoriasNegociosData, categoriasData, promocionesData, productosData, opcionesData, tiposOpcionesData, usuariosData] = await Promise.all([
                    fetch(API_URLS.deliverys).then(r => r.json()),
                    fetch(API_URLS.negocios).then(r => r.json()),
                    fetch(API_URLS.categoriasNegocios).then(r => r.json()),
                    fetch(API_URLS.categorias).then(r => r.json()),
                    fetch(API_URLS.promociones).then(r => r.json()),
                    fetch(API_URLS.productos).then(r => r.json()),
                    fetch(API_URLS.opciones).then(r => r.json()),
                    fetch(API_URLS.tiposOpciones).then(r => r.json()),
                    fetch(API_URLS.usuarios).then(r => r.json())
                ]);
                
                // Asignar datos a variables globales y filtrar solo los activos
                deliverys = (deliverysData || []).filter(item => item.estado === 'Activo');
                negocios = (negociosData || []).filter(item => item.estado === 'Activo');
                categoriasNegocios = (categoriasNegociosData || []).filter(item => item.estado === 'Activo');
                categorias = (categoriasData || []).filter(item => item.estado === 'Activo');
                promociones = (promocionesData || []).filter(item => item.estado === 'Activo');
                productos = (productosData || []).filter(item => item.estado === 'Activo');
                opciones = (opcionesData || []).filter(item => item.estado === 'Activo');
                tiposOpciones = (tiposOpcionesData || []).filter(item => item.estado === 'Activo');
                usuarios = (usuariosData || []).filter(item => item.estado === 'Activo');
                
                // Procesar par√°metros de URL
                procesarParametrosURL();
                
                // Procesar y organizar opciones por producto
                procesarOpciones();
                
                // Renderizar contenido seg√∫n el contexto
                renderizarContenido();
                
                mostrarCargando(false);
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                mostrarError('Error al cargar los datos. Por favor, recarga la p√°gina.');
                mostrarCargando(false);
            }
        }
        
        // Procesar par√°metros de URL
        function procesarParametrosURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const deliveryId = urlParams.get('delivery');
            const negocioId = urlParams.get('negocio');
            
            if (deliveryId) {
                deliveryActual = deliverys.find(d => d.id == deliveryId);
                if (negocioId) {
                    negocioActual = negocios.find(n => n.id == negocioId && n.delivery_id == deliveryId);
                    if (negocioActual) {
                        vistaActual = 'productos';
                    }
                }
            }
        }
        
        // Renderizar contenido seg√∫n el contexto
        function renderizarContenido() {
            if (usuarioActual) {
                renderizarPanelAdmin();
            } else if (negocioActual) {
                renderizarMenuNegocio();
            } else if (deliveryActual) {
                renderizarNegociosDelivery();
            } else {
                // Vista por defecto - mostrar primer delivery o mensaje
                if (deliverys.length > 0) {
                    deliveryActual = deliverys[0];
                    renderizarNegociosDelivery();
                } else {
                    mostrarMensajeSinDatos();
                }
            }
        }
        
        // Renderizar panel de administraci√≥n
        function renderizarPanelAdmin() {
            const vistaDeliverys = document.getElementById('vista-deliverys');
            const seccionPromociones = document.getElementById('seccion-promociones');
            const seccionFiltros = document.getElementById('seccion-filtros');
            const negociosContainer = document.getElementById('negocios-container');
            const productosContainer = document.getElementById('productos-container');
            
            if (usuarioActual.tipo === 'Admin') {
                // Admin ve todos los deliverys
                vistaDeliverys.classList.remove('hidden');
                seccionPromociones.classList.add('hidden');
                seccionFiltros.classList.add('hidden');
                negociosContainer.classList.add('hidden');
                productosContainer.classList.add('hidden');
                
                renderizarDeliverys();
            } else if (usuarioActual.tipo === 'Delivery') {
                // Delivery ve sus negocios
                deliveryActual = deliverys.find(d => d.id == usuarioActual.delivery_id);
                if (deliveryActual) {
                    renderizarNegociosDelivery();
                }
            } else if (usuarioActual.tipo === 'Comercio') {
                // Comercio ve su men√∫
                negocioActual = negocios.find(n => n.id == usuarioActual.negocio_id);
                if (negocioActual) {
                    deliveryActual = deliverys.find(d => d.id == negocioActual.delivery_id);
                    renderizarMenuNegocio();
                }
            }
        }
        
        // Renderizar deliverys (solo para Admin)
        function renderizarDeliverys() {
            const container = document.getElementById('deliverys-container');
            container.innerHTML = '';
            
            deliverys.forEach(delivery => {
                const deliveryCard = crearTarjetaDelivery(delivery);
                container.appendChild(deliveryCard);
            });
            
            actualizarHeader('üöö Panel de Administraci√≥n', 'Gesti√≥n de todos los deliverys');
        }
        
        // Crear tarjeta de delivery
        function crearTarjetaDelivery(delivery) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300';
            
            card.innerHTML = `
                <div class="relative h-48">
                    ${delivery.imagen_url ? 
                        `<img src="${delivery.imagen_url}" alt="${delivery.nombre}" class="w-full h-full object-cover">` :
                        `<div class="w-full h-full bg-gradient-to-br from-red-400 to-red-600 flex items-center justify-center">
                            <div class="text-center text-white">
                                <div class="text-6xl mb-2">üöö</div>
                                <div class="text-lg font-semibold">${delivery.nombre}</div>
                            </div>
                        </div>`
                    }
                    ${delivery.logo_url ? 
                        `<div class="absolute top-2 left-2">
                            <img src="${delivery.logo_url}" alt="Logo ${delivery.nombre}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md">
                        </div>` : ''
                    }
                </div>
                <div class="p-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${delivery.nombre}</h3>
                    <p class="text-gray-600 mb-4">${delivery.descripcion || delivery.slogan || 'Delivery de comida'}</p>
                    <div class="flex justify-between items-center">
                        <button onclick="verNegociosDelivery(${delivery.id})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-300">
                            Ver Negocios
                        </button>
                        <button onclick="compartirDelivery(${delivery.id})" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-300">
                            üì§ Compartir
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Ver negocios de un delivery espec√≠fico
        function verNegociosDelivery(deliveryId) {
            deliveryActual = deliverys.find(d => d.id == deliveryId);
            if (deliveryActual) {
                vistaActual = 'negocios';
                renderizarNegociosDelivery();
                
                // Ocultar vista de deliverys
                document.getElementById('vista-deliverys').classList.add('hidden');
            }
        }
        
        // Renderizar negocios de un delivery
        function renderizarNegociosDelivery() {
            if (!deliveryActual) return;
            
            // Mostrar secciones relevantes
            document.getElementById('vista-deliverys').classList.add('hidden');
            document.getElementById('seccion-promociones').classList.remove('hidden');
            document.getElementById('seccion-filtros').classList.remove('hidden');
            document.getElementById('negocios-container').classList.remove('hidden');
            document.getElementById('productos-container').classList.add('hidden');
            document.getElementById('breadcrumb').classList.add('hidden');
            
            // Filtrar datos del delivery actual
            const negociosDelivery = negocios.filter(n => n.delivery_id == deliveryActual.id);
            const promocionesDelivery = promociones.filter(p => 
                p.delivery_id == deliveryActual.id || 
                negociosDelivery.some(n => n.id == p.negocio_id)
            );
            
            // Actualizar header
            actualizarHeader(deliveryActual.nombre, deliveryActual.slogan || 'Los mejores sabores a tu puerta');
            
            // Renderizar componentes
            renderizarPromociones(promocionesDelivery);
            renderizarCategoriasNegocios();
            renderizarNegocios(negociosDelivery);
            
            // Actualizar bot√≥n compartir
            document.getElementById('btn-compartir').classList.remove('hidden');
            
            // Actualizar WhatsApp flotante
            actualizarWhatsAppFlotante(deliveryActual.telefono);
        }
        
        // Renderizar men√∫ de un negocio espec√≠fico
        function renderizarMenuNegocio() {
            if (!negocioActual || !deliveryActual) return;
            
            // Mostrar secciones relevantes
            document.getElementById('vista-deliverys').classList.add('hidden');
            document.getElementById('seccion-promociones').classList.remove('hidden');
            document.getElementById('seccion-filtros').classList.remove('hidden');
            document.getElementById('negocios-container').classList.add('hidden');
            document.getElementById('productos-container').classList.remove('hidden');
            document.getElementById('breadcrumb').classList.remove('hidden');
            
            // Filtrar datos del negocio actual
            const promocionesNegocio = promociones.filter(p => p.negocio_id == negocioActual.id);
            const categoriasNegocio = categorias.filter(c => 
                productos.some(p => p.negocio_id == negocioActual.id && p.categoria_id == c.id)
            );
            const productosNegocio = productos.filter(p => p.negocio_id == negocioActual.id);
            
            // Actualizar header
            actualizarHeader(negocioActual.nombre, negocioActual.descripcion || 'Men√∫ digital');
            
            // Actualizar breadcrumb
            document.getElementById('breadcrumb-negocio').innerHTML = ` > <span class="text-red-600">${negocioActual.nombre}</span>`;
            
            // Renderizar componentes
            renderizarPromociones(promocionesNegocio);
            renderizarCategorias(categoriasNegocio);
            renderizarProductosPorCategorias(productosNegocio, categoriasNegocio);
            
            // Actualizar bot√≥n compartir
            document.getElementById('btn-compartir').classList.remove('hidden');
            
            // Actualizar WhatsApp flotante
            actualizarWhatsAppFlotante(deliveryActual.telefono);
        }
        
        // Actualizar header din√°micamente
        function actualizarHeader(titulo, slogan) {
            document.querySelector('header h1').textContent = titulo;
            document.getElementById('header-slogan').textContent = slogan;
            
            // Actualizar logo si existe
            const logoContainer = document.getElementById('logo-container');
            const logoImg = document.getElementById('logo-negocio');
            
            let logoUrl = null;
            if (negocioActual && negocioActual.logo_url) {
                logoUrl = negocioActual.logo_url;
            } else if (deliveryActual && deliveryActual.logo_url) {
                logoUrl = deliveryActual.logo_url;
            }
            
            if (logoUrl) {
                logoImg.src = logoUrl;
                logoImg.onerror = function() {
                    logoContainer.classList.add('hidden');
                };
                logoContainer.classList.remove('hidden');
            } else {
                logoContainer.classList.add('hidden');
            }
        }
        
        // Renderizar promociones
        function renderizarPromociones(promocionesData) {
            const carruselContainer = document.getElementById('carrusel-promociones');
            const indicadoresContainer = carruselContainer.parentElement.querySelector('.absolute.bottom-4');
            
            if (!carruselContainer) return;
            
            carruselContainer.innerHTML = '';
            indicadoresContainer.innerHTML = '';
            
            totalSlides = promocionesData.length;
            
            if (totalSlides === 0) {
                document.getElementById('seccion-promociones').classList.add('hidden');
                return;
            }
            
            document.getElementById('seccion-promociones').classList.remove('hidden');
            
            promocionesData.forEach((promocion, index) => {
                // Crear slide de promoci√≥n
                const slide = document.createElement('div');
                slide.className = 'w-full flex-shrink-0 relative';
                
                const colorInicio = promocion.color_ini || '#ef4444';
                const colorFin = promocion.color_fin || '#f97316';
                
                slide.innerHTML = `
                    <div class="text-white p-6 md:p-8 rounded-lg" style="background: linear-gradient(to right, ${colorInicio}, ${colorFin})">
                        <div class="flex flex-col md:flex-row items-center">
                            <div class="md:w-1/3 mb-4 md:mb-0">
                                ${promocion.imagen_url ? 
                                    `<img src="${promocion.imagen_url}" alt="${promocion.titulo}" class="w-24 h-24 md:w-32 md:h-32 mx-auto rounded-full object-cover">` :
                                    `<div class="text-8xl md:text-9xl text-center">üéâ</div>`
                                }
                            </div>
                            <div class="md:w-2/3 md:pl-6 text-center md:text-left">
                                <h3 class="text-2xl md:text-3xl font-bold mb-2">${promocion.titulo}</h3>
                                <p class="text-lg mb-4">${promocion.detalle}</p>
                                ${promocion.ahorro ? 
                                    `<div class="bg-white text-gray-800 px-4 py-2 rounded-full inline-block font-bold">
                                        ${promocion.ahorro}
                                    </div>` : ''
                                }
                            </div>
                        </div>
                    </div>
                `;
                
                carruselContainer.appendChild(slide);
                
                // Crear indicador
                const indicador = document.createElement('button');
                indicador.onclick = () => irASlide(index);
                indicador.className = `w-3 h-3 rounded-full bg-white ${index === 0 ? 'bg-opacity-100' : 'bg-opacity-50'} hover:bg-opacity-100 transition duration-300`;
                indicador.id = `indicador-${index}`;
                indicadoresContainer.appendChild(indicador);
            });
            
            // Reiniciar carrusel
            slideActual = 0;
            actualizarCarrusel();
        }
        
        // Renderizar categor√≠as de negocios
        function renderizarCategoriasNegocios() {
            const contenedorFiltros = document.getElementById('filtros-categorias');
            if (!contenedorFiltros) return;
            
            contenedorFiltros.innerHTML = '';
            
            // Agregar bot√≥n "Todas"
            const btnTodas = document.createElement('button');
            btnTodas.onclick = () => filtrarCategoriaNegocio('todas');
            btnTodas.className = 'categoria-btn bg-red-600 text-white px-4 py-2 rounded-full font-semibold hover:bg-red-700 transition duration-300';
            btnTodas.textContent = 'Todas';
            contenedorFiltros.appendChild(btnTodas);
            
            // Agregar categor√≠as din√°micas
            categoriasNegocios.forEach(categoria => {
                const btn = document.createElement('button');
                btn.onclick = () => filtrarCategoriaNegocio(categoria.id);
                btn.className = 'categoria-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-gray-300 transition duration-300';
                btn.textContent = `${categoria.icono} ${categoria.nombre}`;
                contenedorFiltros.appendChild(btn);
            });
        }
        
        // Renderizar categor√≠as de productos
        function renderizarCategorias(categoriasData) {
            const contenedorFiltros = document.getElementById('filtros-categorias');
            if (!contenedorFiltros) return;
            
            contenedorFiltros.innerHTML = '';
            
            // Agregar bot√≥n "Todas"
            const btnTodas = document.createElement('button');
            btnTodas.onclick = () => filtrarCategoria('todas');
            btnTodas.className = 'categoria-btn bg-red-600 text-white px-4 py-2 rounded-full font-semibold hover:bg-red-700 transition duration-300';
            btnTodas.textContent = 'Todas';
            contenedorFiltros.appendChild(btnTodas);
            
            // Agregar categor√≠as din√°micas
            categoriasData.forEach(categoria => {
                const btn = document.createElement('button');
                btn.onclick = () => filtrarCategoria(categoria.id);
                btn.className = 'categoria-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-gray-300 transition duration-300';
                btn.textContent = `${categoria.icono} ${categoria.nombre}`;
                contenedorFiltros.appendChild(btn);
            });
        }
        
        // Renderizar negocios
        function renderizarNegocios(negociosData) {
            const negociosContainer = document.getElementById('negocios-container');
            if (!negociosContainer) return;
            
            negociosContainer.innerHTML = '';
            
            if (categoriaActual === 'todas') {
                // Mostrar todos los negocios
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';
                
                negociosData.forEach(negocio => {
                    const negocioCard = crearTarjetaNegocio(negocio);
                    grid.appendChild(negocioCard);
                });
                
                negociosContainer.appendChild(grid);
            } else {
                // Filtrar por categor√≠a
                const negociosFiltrados = negociosData.filter(n => n.categoria_negocio_id == categoriaActual);
                
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';
                
                negociosFiltrados.forEach(negocio => {
                    const negocioCard = crearTarjetaNegocio(negocio);
                    grid.appendChild(negocioCard);
                });
                
                negociosContainer.appendChild(grid);
            }
        }
        
        // Crear tarjeta de negocio
        function crearTarjetaNegocio(negocio) {
            const categoria = categoriasNegocios.find(c => c.id == negocio.categoria_negocio_id);
            
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300';
            
            card.innerHTML = `
                <div class="relative h-48">
                    ${negocio.imagen_url ? 
                        `<img src="${negocio.imagen_url}" alt="${negocio.nombre}" class="w-full h-full object-cover">` :
                        `<div class="w-full h-full bg-gradient-to-br from-gray-200 to-gray-400 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-6xl mb-2">${categoria ? categoria.icono : 'üè™'}</div>
                                <div class="text-sm font-semibold text-gray-700">${negocio.nombre}</div>
                            </div>
                        </div>`
                    }
                    ${negocio.logo_url ? 
                        `<div class="absolute top-2 left-2">
                            <img src="${negocio.logo_url}" alt="Logo ${negocio.nombre}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md">
                        </div>` : ''
                    }
                </div>
                <div class="p-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${negocio.nombre}</h3>
                    <p class="text-gray-600 mb-4">${negocio.descripcion || 'Deliciosa comida te espera'}</p>
                    <div class="flex justify-between items-center">
                        <button onclick="verMenuNegocio(${negocio.id})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-300">
                            Ver Men√∫
                        </button>
                        <button onclick="compartirNegocio(${negocio.id})" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-300">
                            üì§ Compartir
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Ver men√∫ de un negocio espec√≠fico
        function verMenuNegocio(negocioId) {
            negocioActual = negocios.find(n => n.id == negocioId);
            if (negocioActual) {
                if (!deliveryActual) {
                    deliveryActual = deliverys.find(d => d.id == negocioActual.delivery_id);
                }
                vistaActual = 'productos';
                renderizarMenuNegocio();
            }
        }
        
        // Volver a vista de negocios
        function volverANegocios() {
            negocioActual = null;
            vistaActual = 'negocios';
            categoriaActual = 'todas';
            renderizarNegociosDelivery();
        }
        
        // Renderizar productos por categor√≠as
        function renderizarProductosPorCategorias(productosData, categoriasData) {
            const productosContainer = document.getElementById('productos-container');
            if (!productosContainer) return;
            
            productosContainer.innerHTML = '';
            
            if (categoriaActual === 'todas') {
                // Mostrar productos organizados por categor√≠as
                categoriasData.forEach(categoria => {
                    const productosCategoria = productosData.filter(p => p.categoria_id == categoria.id);
                    
                    if (productosCategoria.length > 0) {
                        // Crear secci√≥n de categor√≠a
                        const seccionCategoria = document.createElement('div');
                        seccionCategoria.className = 'mb-12';
                        seccionCategoria.innerHTML = `
                            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                <span class="text-3xl mr-3">${categoria.icono}</span>
                                ${categoria.nombre}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="categoria-${categoria.id}">
                            </div>
                        `;
                        
                        productosContainer.appendChild(seccionCategoria);
                        
                        // Agregar productos a esta categor√≠a
                        const gridCategoria = document.getElementById(`categoria-${categoria.id}`);
                        productosCategoria.forEach((producto, index) => {
                            const productoCard = crearTarjetaProducto(producto, index);
                            gridCategoria.appendChild(productoCard);
                        });
                    }
                });
            } else {
                // Mostrar solo productos de la categor√≠a seleccionada
                const productosCategoria = productosData.filter(p => p.categoria_id == categoriaActual);
                const categoria = categoriasData.find(c => c.id == categoriaActual);
                
                if (productosCategoria.length > 0) {
                    const seccionCategoria = document.createElement('div');
                    seccionCategoria.innerHTML = `
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="text-3xl mr-3">${categoria ? categoria.icono : 'üçΩÔ∏è'}</span>
                            ${categoria ? categoria.nombre : 'Productos'}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="productos-filtrados">
                        </div>
                    `;
                    
                    productosContainer.appendChild(seccionCategoria);
                    
                    const gridFiltrado = document.getElementById('productos-filtrados');
                    productosCategoria.forEach((producto, index) => {
                        const productoCard = crearTarjetaProducto(producto, index);
                        gridFiltrado.appendChild(productoCard);
                    });
                }
            }
        }
        
        // Crear tarjeta de producto
        function crearTarjetaProducto(producto, index) {
            const categoria = categorias.find(c => c.id == producto.categoria_id);
            
            const productoCard = document.createElement('div');
            productoCard.className = 'producto-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col hover:shadow-lg transition-shadow duration-300';
            
            productoCard.innerHTML = `
                <div class="relative h-48">
                    ${producto.imagen_url ? 
                        `<img src="${producto.imagen_url}" alt="${producto.nombre}" class="w-full h-full object-cover">` :
                        `<div class="w-full h-full bg-gradient-to-br from-gray-200 to-gray-400 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-6xl mb-2">${categoria ? categoria.icono : 'üçΩÔ∏è'}</div>
                                <div class="text-sm font-semibold text-gray-700">${producto.nombre}</div>
                            </div>
                        </div>`
                    }
                </div>
                <div class="p-4 flex flex-col flex-grow">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800 mb-2">${producto.nombre.toUpperCase()}</h2>
                        <p class="text-sm text-gray-600 mb-4 flex-grow">${producto.descripcion}</p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold text-gray-900">Desde LPS. ${parseFloat(producto.precio_base).toFixed(2)}</span>
                        </div>
                        <div class="flex items-center flex-wrap gap-2">
                            <label for="quantity-${producto.id}-${index}" class="text-sm font-medium text-gray-700">CANTIDAD:</label>
                            <input type="number" id="quantity-${producto.id}-${index}" value="1" min="1" class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center">
                            <button onclick="ordenarProducto('${producto.nombre}', ${producto.precio_base}, 'quantity-${producto.id}-${index}')" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition duration-300">ORDENAR</button>
                        </div>
                    </div>
                </div>
            `;
            
            return productoCard;
        }
        
        // Procesar opciones y organizarlas por producto
        function procesarOpciones() {
            window.productosOpciones = {};
            
            productos.forEach(producto => {
                const opcionesProducto = opciones.filter(op => op.producto_id == producto.id);
                
                if (opcionesProducto.length > 0) {
                    window.productosOpciones[producto.nombre] = {};
                    
                    // Agrupar opciones por tipo din√°micamente
                    tiposOpciones.forEach(tipoOpcion => {
                        const opcionesTipo = opcionesProducto.filter(op => op.tipo === tipoOpcion.nombre);
                        
                        if (opcionesTipo.length > 0) {
                            window.productosOpciones[producto.nombre][tipoOpcion.nombre] = {
                                opciones: opcionesTipo.map(op => ({
                                    nombre: op.nombre,
                                    precio: parseFloat(op.precio) || 0
                                })),
                                configuracion: {
                                    titulo: tipoOpcion.titulo || tipoOpcion.nombre,
                                    tipo_seleccion: tipoOpcion.tipo_seleccion || 'radio',
                                    obligatorio: tipoOpcion.obligatorio === 'Si',
                                    multiple: tipoOpcion.tipo_seleccion === 'checkbox'
                                }
                            };
                        }
                    });
                }
            });
        }
        
        // Funciones de autenticaci√≥n
        function mostrarLogin() {
            document.getElementById('modal-login').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function cerrarLogin() {
            document.getElementById('modal-login').classList.add('hidden');
            document.body.style.overflow = 'auto';
            document.getElementById('input-usuario').value = '';
            document.getElementById('input-clave').value = '';
        }
        
        function validarLogin() {
            const usuario = document.getElementById('input-usuario').value.trim();
            const clave = document.getElementById('input-clave').value.trim();
            
            if (!usuario || !clave) {
                alert('Por favor ingresa usuario y contrase√±a');
                return;
            }
            
            const usuarioEncontrado = usuarios.find(u => u.usuario === usuario && u.clave === clave);
            
            if (usuarioEncontrado) {
                usuarioActual = usuarioEncontrado;
                cerrarLogin();
                
                // Actualizar interfaz
                document.getElementById('btn-login').classList.add('hidden');
                document.getElementById('btn-logout').classList.remove('hidden');
                
                // Renderizar seg√∫n tipo de usuario
                renderizarPanelAdmin();
                
                mostrarNotificacion(`Bienvenido ${usuarioActual.nombre_completo || usuarioActual.usuario}`);
            } else {
                alert('Usuario o contrase√±a incorrectos');
            }
        }
        
        function cerrarSesion() {
            usuarioActual = null;
            deliveryActual = null;
            negocioActual = null;
            vistaActual = 'negocios';
            categoriaActual = 'todas';
            
            // Actualizar interfaz
            document.getElementById('btn-login').classList.remove('hidden');
            document.getElementById('btn-logout').classList.add('hidden');
            document.getElementById('btn-compartir').classList.add('hidden');
            
            // Recargar contenido
            renderizarContenido();
            
            mostrarNotificacion('Sesi√≥n cerrada');
        }
        
        // Funciones de compartir
        function compartirEnlace() {
            let url = window.location.origin + window.location.pathname;
            
            if (negocioActual && deliveryActual) {
                url += `?delivery=${deliveryActual.id}&negocio=${negocioActual.id}`;
            } else if (deliveryActual) {
                url += `?delivery=${deliveryActual.id}`;
            }
            
            if (navigator.share) {
                navigator.share({
                    title: negocioActual ? negocioActual.nombre : (deliveryActual ? deliveryActual.nombre : 'Sistema de Deliverys'),
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    mostrarNotificacion('Enlace copiado al portapapeles');
                });
            }
        }
        
        function compartirDelivery(deliveryId) {
            const url = `${window.location.origin}${window.location.pathname}?delivery=${deliveryId}`;
            
            if (navigator.share) {
                const delivery = deliverys.find(d => d.id == deliveryId);
                navigator.share({
                    title: delivery ? delivery.nombre : 'Delivery',
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    mostrarNotificacion('Enlace del delivery copiado');
                });
            }
        }
        
        function compartirNegocio(negocioId) {
            const negocio = negocios.find(n => n.id == negocioId);
            const url = `${window.location.origin}${window.location.pathname}?delivery=${negocio.delivery_id}&negocio=${negocioId}`;
            
            if (navigator.share) {
                navigator.share({
                    title: negocio ? negocio.nombre : 'Negocio',
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    mostrarNotificacion('Enlace del negocio copiado');
                });
            }
        }
        
        // Actualizar WhatsApp flotante
        function actualizarWhatsAppFlotante(telefono) {
            const whatsappBtn = document.getElementById('whatsapp-flotante');
            if (telefono) {
                const numeroLimpio = telefono.replace(/\D/g, '');
                whatsappBtn.href = `https://wa.me/${numeroLimpio}?text=¬°Hola! Me gustar√≠a hacer un pedido`;
            }
        }
        
        // Filtros
        function filtrarCategoriaNegocio(categoria) {
            categoriaActual = categoria;
            const botones = document.querySelectorAll('.categoria-btn');
            
            // Actualizar botones
            botones.forEach(btn => {
                btn.classList.remove('bg-red-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-red-600', 'text-white');
            
            // Re-renderizar negocios
            const negociosDelivery = negocios.filter(n => n.delivery_id == deliveryActual.id);
            renderizarNegocios(negociosDelivery);
        }
        
        function filtrarCategoria(categoria) {
            categoriaActual = categoria;
            const botones = document.querySelectorAll('.categoria-btn');
            
            // Actualizar botones
            botones.forEach(btn => {
                btn.classList.remove('bg-red-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-red-600', 'text-white');
            
            // Re-renderizar productos
            const productosNegocio = productos.filter(p => p.negocio_id == negocioActual.id);
            const categoriasNegocio = categorias.filter(c => 
                productosNegocio.some(p => p.categoria_id == c.id)
            );
            renderizarProductosPorCategorias(productosNegocio, categoriasNegocio);
        }
        
        // Funciones del carrusel
        function cambiarSlide(direccion) {
            slideActual += direccion;
            if (slideActual >= totalSlides) slideActual = 0;
            if (slideActual < 0) slideActual = totalSlides - 1;
            actualizarCarrusel();
        }

        function irASlide(indice) {
            slideActual = indice;
            actualizarCarrusel();
        }

        function actualizarCarrusel() {
            const carrusel = document.getElementById('carrusel-promociones');
            const desplazamiento = -slideActual * 100;
            carrusel.style.transform = `translateX(${desplazamiento}%)`;
            
            // Actualizar indicadores
            for (let i = 0; i < totalSlides; i++) {
                const indicador = document.getElementById(`indicador-${i}`);
                if (indicador) {
                    if (i === slideActual) {
                        indicador.classList.remove('bg-opacity-50');
                        indicador.classList.add('bg-opacity-100');
                    } else {
                        indicador.classList.remove('bg-opacity-100');
                        indicador.classList.add('bg-opacity-50');
                    }
                }
            }
        }

        // Auto-avanzar el carrusel cada 5 segundos
        setInterval(() => {
            if (totalSlides > 0) {
                cambiarSlide(1);
            }
        }, 5000);

        // Funciones del carrito y productos (mantener las existentes)
        function ordenarProducto(nombre, precio, quantityId) {
            const cantidad = parseInt(document.getElementById(quantityId).value);
            
            // Verificar si el producto tiene opciones
            if (window.productosOpciones && window.productosOpciones[nombre]) {
                abrirModalOpciones(nombre, precio, cantidad, quantityId);
            } else {
                // Agregar directamente si no tiene opciones
                agregarAlCarritoDirecto(nombre, precio, cantidad, quantityId);
            }
        }

        function abrirModalOpciones(nombre, precioBase, cantidad, quantityId) {
            const opciones = window.productosOpciones[nombre];
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.id = 'modal-opciones';
            modal.dataset.nombre = nombre;
            modal.dataset.precioBase = precioBase;
            
            // Generar secciones de opciones din√°micamente
            let seccionesOpciones = '';
            
            Object.keys(opciones).forEach(tipoOpcion => {
                const opcionData = opciones[tipoOpcion];
                const config = opcionData.configuracion;
                const opcionesLista = opcionData.opciones;
                
                const inputType = config.multiple ? 'checkbox' : 'radio';
                const nameAttr = config.multiple ? tipoOpcion : tipoOpcion;
                
                seccionesOpciones += `
                    <div class="mb-6">
                        <h4 class="font-semibold mb-3 text-gray-800">
                            ${config.titulo}${config.obligatorio ? ' *' : ''}:
                        </h4>
                        <div class="space-y-2">
                            ${opcionesLista.map((opcion, index) => `
                                <label class="flex items-center justify-between p-2 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-center">
                                        <input type="${inputType}" name="${nameAttr}" value="${index}" ${!config.multiple && index === 0 ? 'checked' : ''} class="mr-3" data-tipo="${tipoOpcion}">
                                        <span>${opcion.nombre}</span>
                                    </div>
                                    <span class="font-medium ${opcion.precio > 0 ? 'text-green-600' : opcion.precio < 0 ? 'text-red-600' : 'text-gray-600'}">
                                        ${opcion.precio > 0 ? '+' : ''}${opcion.precio === 0 ? 'Incluido' : 'LPS. ' + opcion.precio.toFixed(2)}
                                    </span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
                    <div class="bg-red-600 text-white p-4 flex justify-between items-center">
                        <h3 class="text-lg font-bold">Personalizar ${nombre}</h3>
                        <button onclick="cerrarModalOpciones()" class="text-white hover:text-gray-200 text-xl">√ó</button>
                    </div>
                    
                    <div class="p-4">
                        <div class="mb-4 flex items-center space-x-4">
                            <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                                ${obtenerImagenProducto(nombre)}
                            </div>
                            <div class="flex-1">
                                <div class="text-lg font-semibold">Precio base: LPS. ${precioBase.toFixed(2)}</div>
                                <div class="flex items-center space-x-2 mt-2">
                                    <span class="text-sm text-gray-600">Cantidad:</span>
                                    <button onclick="cambiarCantidadModal(-1)" class="bg-gray-300 hover:bg-gray-400 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center text-sm">-</button>
                                    <span id="cantidad-modal" class="text-sm font-medium min-w-[20px] text-center">${cantidad}</span>
                                    <button onclick="cambiarCantidadModal(1)" class="bg-gray-300 hover:bg-gray-400 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center text-sm">+</button>
                                </div>
                            </div>
                        </div>
                        
                        ${seccionesOpciones}
                        
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-bold">Total:</span>
                                <span id="precio-total-opciones" class="text-lg font-bold text-red-600">LPS. ${(precioBase * cantidad).toFixed(2)}</span>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button onclick="cerrarModalOpciones()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition duration-300">
                                    Cancelar
                                </button>
                                <button onclick="confirmarOpcionesProducto('${nombre}', ${precioBase}, ${cantidad}, '${quantityId}')" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300">
                                    Agregar al carrito
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Agregar event listeners para actualizar precio
            const inputs = modal.querySelectorAll('input[type="radio"], input[type="checkbox"]');
            inputs.forEach(input => {
                input.addEventListener('change', () => actualizarPrecioOpciones(nombre, precioBase));
            });
            
            // Actualizar precio inicial
            actualizarPrecioOpciones(nombre, precioBase);
        }

        function cambiarCantidadModal(cambio) {
            const cantidadElement = document.getElementById('cantidad-modal');
            if (!cantidadElement) return;
            
            let cantidadActual = parseInt(cantidadElement.textContent);
            cantidadActual += cambio;
            if (cantidadActual < 1) cantidadActual = 1;
            
            cantidadElement.textContent = cantidadActual;
            
            // Obtener datos del modal actual usando los atributos data guardados
            const modalElement = document.getElementById('modal-opciones');
            if (modalElement) {
                const nombre = modalElement.dataset.nombre;
                const precioBase = parseFloat(modalElement.dataset.precioBase);
                
                // Ahora la funci√≥n actualizarPrecioOpciones siempre lee la cantidad del DOM
                actualizarPrecioOpciones(nombre, precioBase);
            }
        }

        function actualizarPrecioOpciones(nombre, precioBase, cantidadParametro = null) {
            // Obtener la cantidad actual del modal, no del par√°metro
            const cantidadElement = document.getElementById('cantidad-modal');
            const cantidad = cantidadElement ? parseInt(cantidadElement.textContent) : (cantidadParametro || 1);
            
            const opciones = window.productosOpciones[nombre];
            let precioUnitario = precioBase;
            
            // Calcular precios de todas las opciones din√°micamente
            Object.keys(opciones).forEach(tipoOpcion => {
                const opcionData = opciones[tipoOpcion];
                const config = opcionData.configuracion;
                const opcionesLista = opcionData.opciones;
                
                if (config.multiple) {
                    // Para checkboxes (m√∫ltiple selecci√≥n)
                    const opcionesSeleccionadas = document.querySelectorAll(`input[name="${tipoOpcion}"]:checked`);
                    opcionesSeleccionadas.forEach(opcion => {
                        const indice = parseInt(opcion.value);
                        if (opcionesLista[indice]) {
                            precioUnitario += opcionesLista[indice].precio;
                        }
                    });
                } else {
                    // Para radio buttons (selecci√≥n √∫nica)
                    const opcionSeleccionada = document.querySelector(`input[name="${tipoOpcion}"]:checked`);
                    if (opcionSeleccionada) {
                        const indice = parseInt(opcionSeleccionada.value);
                        if (opcionesLista[indice]) {
                            // Para opciones de radio, reemplazar el precio base si es el primer tipo
                            const esPrimerTipo = Object.keys(opciones)[0] === tipoOpcion;
                            if (esPrimerTipo) {
                                precioUnitario = precioBase + opcionesLista[indice].precio;
                            } else {
                                precioUnitario += opcionesLista[indice].precio;
                            }
                        }
                    }
                }
            });
            
            const precioTotal = precioUnitario * cantidad;
            
            const precioTotalElement = document.getElementById('precio-total-opciones');
            if (precioTotalElement) {
                precioTotalElement.textContent = `LPS. ${precioTotal.toFixed(2)}`;
            }
        }

        function confirmarOpcionesProducto(nombre, precioBase, cantidadOriginal, quantityId) {
            // Obtener la cantidad actual del modal
            const cantidadElement = document.getElementById('cantidad-modal');
            const cantidad = cantidadElement ? parseInt(cantidadElement.textContent) : cantidadOriginal;
            
            const opciones = window.productosOpciones[nombre];
            let precioUnitario = precioBase;
            let nombreFinal = nombre;
            let detallesOpciones = [];
            
            // Procesar todas las opciones din√°micamente
            Object.keys(opciones).forEach(tipoOpcion => {
                const opcionData = opciones[tipoOpcion];
                const config = opcionData.configuracion;
                const opcionesLista = opcionData.opciones;
                
                if (config.multiple) {
                    // Para checkboxes (m√∫ltiple selecci√≥n)
                    const opcionesSeleccionadas = document.querySelectorAll(`input[name="${tipoOpcion}"]:checked`);
                    const opcionesTexto = [];
                    
                    opcionesSeleccionadas.forEach(opcion => {
                        const indice = parseInt(opcion.value);
                        if (opcionesLista[indice]) {
                            precioUnitario += opcionesLista[indice].precio;
                            opcionesTexto.push(opcionesLista[indice].nombre);
                        }
                    });
                    
                    if (opcionesTexto.length > 0) {
                        detallesOpciones.push(`${config.titulo}: ${opcionesTexto.join(', ')}`);
                    }
                } else {
                    // Para radio buttons (selecci√≥n √∫nica)
                    const opcionSeleccionada = document.querySelector(`input[name="${tipoOpcion}"]:checked`);
                    if (opcionSeleccionada) {
                        const indice = parseInt(opcionSeleccionada.value);
                        if (opcionesLista[indice]) {
                            // Para opciones de radio, reemplazar el precio base si es el primer tipo
                            const esPrimerTipo = Object.keys(opciones)[0] === tipoOpcion;
                            if (esPrimerTipo) {
                                precioUnitario = precioBase + opcionesLista[indice].precio;
                            } else {
                                precioUnitario += opcionesLista[indice].precio;
                            }
                            detallesOpciones.push(`${config.titulo}: ${opcionesLista[indice].nombre}`);
                        }
                    }
                }
            });
            
            // Crear nombre completo del producto
            if (detallesOpciones.length > 0) {
                nombreFinal += ` (${detallesOpciones.join(' | ')})`;
            }
            
            // Agregar al carrito
            const subtotal = precioUnitario * cantidad;
            
            carrito.push({
                id: Date.now() + Math.random(),
                nombre: nombreFinal,
                precio: precioUnitario,
                cantidad: cantidad,
                subtotal: subtotal,
                imagen: obtenerImagenProducto(nombre)
            });
            
            actualizarCarrito();
            mostrarNotificacion(`${nombreFinal} agregado al carrito`);
            
            // Resetear cantidad y cerrar modal
            document.getElementById(quantityId).value = 1;
            cerrarModalOpciones();
        }

        function agregarAlCarritoDirecto(nombre, precio, cantidad, quantityId) {
            const subtotal = precio * cantidad;
            
            // Buscar si el producto ya existe en el carrito
            const productoExistente = carrito.find(item => item.nombre === nombre);
            
            if (productoExistente) {
                productoExistente.cantidad += cantidad;
                productoExistente.subtotal += subtotal;
            } else {
                carrito.push({
                    id: Date.now() + Math.random(),
                    nombre: nombre,
                    precio: precio,
                    cantidad: cantidad,
                    subtotal: subtotal,
                    imagen: obtenerImagenProducto(nombre)
                });
            }
            
            actualizarCarrito();
            mostrarNotificacion(`${nombre} agregado al carrito`);
            
            // Resetear cantidad a 1
            document.getElementById(quantityId).value = 1;
        }

        function cerrarModalOpciones() {
            const modal = document.getElementById('modal-opciones');
            if (modal) {
                document.body.removeChild(modal);
                document.body.style.overflow = 'auto';
            }
        }

        function actualizarCarrito() {
            const carritoFlotante = document.getElementById('carrito-flotante');
            const contadorCarrito = document.getElementById('contador-carrito');
            const itemsCarritoModal = document.getElementById('items-carrito-modal');
            const totalCarritoModal = document.getElementById('total-carrito-modal');
            const carritoVacio = document.getElementById('carrito-vacio');
            const footerCarrito = document.getElementById('footer-carrito');
            
            // Calcular total de items
            const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
            
            if (carrito.length === 0) {
                carritoFlotante.classList.add('hidden');
                carritoVacio.classList.remove('hidden');
                footerCarrito.classList.add('hidden');
                return;
            }
            
            // Mostrar bot√≥n flotante
            carritoFlotante.classList.remove('hidden');
            contadorCarrito.textContent = totalItems;
            
            // Actualizar modal
            carritoVacio.classList.add('hidden');
            footerCarrito.classList.remove('hidden');
            itemsCarritoModal.innerHTML = '';
            total = 0;
            
            carrito.forEach((item) => {
                total += item.subtotal;
                const itemDiv = document.createElement('div');
                itemDiv.className = 'bg-gray-50 rounded-lg p-3';
                itemDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-12 h-12 rounded-lg overflow-hidden flex-shrink-0">
                            ${item.imagen}
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-medium text-sm">${item.nombre}</h4>
                                <button onclick="eliminarDelCarrito('${item.id}')" class="text-red-600 hover:text-red-800 text-lg ml-2">√ó</button>
                            </div>
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-2">
                                    <button onclick="cambiarCantidad('${item.id}', -1)" class="bg-gray-300 hover:bg-gray-400 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center text-sm">-</button>
                                    <span class="text-sm font-medium">${item.cantidad}</span>
                                    <button onclick="cambiarCantidad('${item.id}', 1)" class="bg-gray-300 hover:bg-gray-400 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center text-sm">+</button>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-600">LPS. ${item.precio.toFixed(2)} c/u</div>
                                    <div class="font-semibold">LPS. ${item.subtotal.toFixed(2)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                itemsCarritoModal.appendChild(itemDiv);
            });
            
            totalCarritoModal.textContent = `LPS. ${total.toFixed(2)}`;
        }

        function cambiarCantidad(itemId, cambio) {
            const item = carrito.find(producto => producto.id == itemId);
            if (item) {
                item.cantidad += cambio;
                if (item.cantidad <= 0) {
                    eliminarDelCarrito(itemId);
                    return;
                }
                item.subtotal = item.precio * item.cantidad;
                actualizarCarrito();
            }
        }

        function eliminarDelCarrito(itemId) {
            carrito = carrito.filter(item => item.id != itemId);
            actualizarCarrito();
            
            // Si el carrito queda vac√≠o, cerrar el modal
            if (carrito.length === 0) {
                setTimeout(() => {
                    cerrarModal();
                }, 500);
            }
        }

        function vaciarCarrito() {
            carrito = [];
            actualizarCarrito();
            cerrarModal();
            mostrarNotificacion('Carrito vaciado');
        }

        function abrirModal() {
            document.getElementById('modal-carrito').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function cerrarModal() {
            document.getElementById('modal-carrito').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function obtenerImagenProducto(nombre) {
            // Extraer el nombre base del producto (sin opciones)
            const nombreBase = nombre.split(' (')[0];
            
            // Buscar el producto en los datos cargados
            const producto = productos.find(p => p.nombre === nombreBase);
            
            if (producto && producto.imagen_url) {
                return `<img src="${producto.imagen_url}" alt="${producto.nombre}" class="w-full h-full object-cover rounded">`;
            }
            
            // Buscar la categor√≠a del producto para usar su icono
            if (producto) {
                const categoria = categorias.find(c => c.id == producto.categoria_id);
                const icono = categoria ? categoria.icono : 'üçΩÔ∏è';
                return `<div class="w-full h-full bg-gradient-to-br from-gray-200 to-gray-400 flex items-center justify-center text-2xl">${icono}</div>`;
            }
            
            // Fallback por defecto
            return '<div class="w-full h-full bg-gray-200 flex items-center justify-center text-2xl">üçΩÔ∏è</div>';
        }

        function actualizarCamposFormulario() {
            const tipoPedido = document.getElementById('tipo-pedido').value;
            const campoTelefono = document.getElementById('campo-telefono');
            const campoDireccion = document.getElementById('campo-direccion');
            const campoMesa = document.getElementById('campo-mesa');
            
            // Resetear campos
            campoTelefono.classList.remove('hidden');
            campoDireccion.classList.add('hidden');
            campoMesa.classList.add('hidden');
            
            if (tipoPedido === 'domicilio') {
                campoDireccion.classList.remove('hidden');
            } else if (tipoPedido === 'llevar') {
                // Solo tel√©fono visible
            } else if (tipoPedido === 'restaurante') {
                campoTelefono.classList.add('hidden');
                campoMesa.classList.remove('hidden');
            }
        }

        function validarFormulario() {
            const tipoPedido = document.getElementById('tipo-pedido').value;
            const nombre = document.getElementById('nombre-cliente').value.trim();
            const telefono = document.getElementById('telefono-cliente').value.trim();
            const direccion = document.getElementById('direccion-cliente').value.trim();
            
            // Nombre siempre es obligatorio
            if (!nombre) {
                alert('Por favor ingresa tu nombre');
                return false;
            }
            
            // Validaciones seg√∫n tipo de pedido
            if (tipoPedido === 'domicilio') {
                if (!telefono) {
                    alert('Por favor ingresa tu tel√©fono para el env√≠o a domicilio');
                    return false;
                }
                if (!direccion) {
                    alert('Por favor ingresa tu direcci√≥n para el env√≠o a domicilio');
                    return false;
                }
            } else if (tipoPedido === 'llevar') {
                if (!telefono) {
                    alert('Por favor ingresa tu tel√©fono para el pedido para llevar');
                    return false;
                }
            }
            
            return true;
        }

        function enviarPorWhatsApp() {
            if (carrito.length === 0) {
                alert('Tu carrito est√° vac√≠o');
                return;
            }
            
            if (!validarFormulario()) {
                return;
            }
            
            const tipoPedido = document.getElementById('tipo-pedido').value;
            const nombre = document.getElementById('nombre-cliente').value.trim();
            const telefono = document.getElementById('telefono-cliente').value.trim();
            const direccion = document.getElementById('direccion-cliente').value.trim();
            const mesa = document.getElementById('mesa-cliente').value.trim();
            const notificarComercio = document.getElementById('notificar-comercio').checked;
            
            // Crear mensaje base
            let mensaje = `üçï *NUEVO PEDIDO* üçï\n\n`;
            
            // Informaci√≥n del delivery y negocio
            if (deliveryActual) {
                mensaje += `üöö *Delivery:* ${deliveryActual.nombre}\n`;
            }
            if (negocioActual) {
                mensaje += `üè™ *Negocio:* ${negocioActual.nombre}\n`;
            }
            mensaje += '\n';
            
            // Informaci√≥n del cliente
            mensaje += '*DATOS DEL CLIENTE:*\n';
            mensaje += `üë§ Nombre: ${nombre}\n`;
            
            if (tipoPedido === 'domicilio') {
                mensaje += `üöö Tipo: Env√≠o a domicilio\n`;
                mensaje += `üìû Tel√©fono: ${telefono}\n`;
                mensaje += `üìç Direcci√≥n: ${direccion}\n`;
            } else if (tipoPedido === 'llevar') {
                mensaje += `ü•° Tipo: Para llevar\n`;
                mensaje += `üìû Tel√©fono: ${telefono}\n`;
            } else if (tipoPedido === 'restaurante') {
                mensaje += `üçΩÔ∏è Tipo: Comer en restaurante\n`;
                if (mesa) {
                    mensaje += `ü™ë Mesa: ${mesa}\n`;
                }
            }
            
            mensaje += '\n*PRODUCTOS:*\n';
            
            carrito.forEach(item => {
                mensaje += `‚Ä¢ ${item.nombre}\n`;
                mensaje += `  Cantidad: ${item.cantidad}\n`;
                mensaje += `  Precio unitario: LPS. ${item.precio.toFixed(2)}\n`;
                mensaje += `  Subtotal: LPS. ${item.subtotal.toFixed(2)}\n\n`;
            });
            
            mensaje += `*TOTAL: LPS. ${total.toFixed(2)}*\n\n`;
            mensaje += '¬°Gracias por tu pedido! üòä';
            
            // Enviar al Delivery (principal)
            if (deliveryActual && deliveryActual.telefono) {
                const numeroDelivery = deliveryActual.telefono.replace(/\D/g, '');
                const urlDelivery = `https://wa.me/${numeroDelivery}?text=${encodeURIComponent(mensaje)}`;
                window.open(urlDelivery, '_blank');
            }
            
            // Enviar al Comercio si est√° marcado
            if (notificarComercio && negocioActual && negocioActual.telefono) {
                const mensajeComercio = mensaje.replace('üçï *NUEVO PEDIDO* üçï', 'üçï *PEDIDO PARA TU NEGOCIO* üçï');
                const numeroComercio = negocioActual.telefono.replace(/\D/g, '');
                const urlComercio = `https://wa.me/${numeroComercio}?text=${encodeURIComponent(mensajeComercio)}`;
                
                // Abrir despu√©s de un peque√±o delay para evitar bloqueo de popups
                setTimeout(() => {
                    window.open(urlComercio, '_blank');
                }, 1000);
            }
        }
        
        // Funciones de utilidad
        function mostrarCargando(mostrar) {
            let loader = document.getElementById('loader-principal');
            if (!loader && mostrar) {
                loader = document.createElement('div');
                loader.id = 'loader-principal';
                loader.className = 'fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50';
                loader.innerHTML = `
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-red-600 mx-auto mb-4"></div>
                        <p class="text-gray-600 text-lg">Cargando datos...</p>
                    </div>
                `;
                document.body.appendChild(loader);
            } else if (loader && !mostrar) {
                loader.remove();
            }
        }
        
        function mostrarError(mensaje) {
            const error = document.createElement('div');
            error.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-md shadow-lg z-50';
            error.textContent = mensaje;
            document.body.appendChild(error);
            setTimeout(() => error.remove(), 5000);
        }
        
        function mostrarNotificacion(mensaje) {
            const notificacion = document.createElement('div');
            notificacion.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg z-50 transition-opacity duration-300';
            notificacion.textContent = mensaje;
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notificacion)) {
                        document.body.removeChild(notificacion);
                    }
                }, 300);
            }, 3000);
        }
        
        function mostrarMensajeSinDatos() {
            document.querySelector('.container').innerHTML = `
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">üöö</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">No hay deliverys disponibles</h2>
                    <p class="text-gray-600">Por favor, contacta al administrador para configurar los deliverys.</p>
                </div>
            `;
        }

        // Cerrar modales al hacer clic fuera
        document.getElementById('modal-carrito').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarModal();
            }
        });
        
        document.getElementById('modal-login').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarLogin();
            }
        });

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosCompletos();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97fcf7c736cf19be',t:'MTc1Nzk5MDA5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
