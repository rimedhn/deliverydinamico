<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Deliverys</title>
    <link id="favicon" rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçï</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Estilos din√°micos para colores */
        .header-dynamic {
            transition: background 0.3s ease;
        }
        
        .footer-dynamic {
            transition: background 0.3s ease;
        }
        
        /* Mobile navbar */
        .mobile-navbar {
            position: fixed;
            top: 4px;
            right: 4px;
            z-index: 1000;
            background: white;
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px;
            display: flex;
            gap: 8px;
        }
        
        .mobile-navbar button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* Carrusel mejorado */
        .carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .carousel-slide {
            width: 100%;
            flex-shrink: 0;
            position: relative;
            height: 320px;
            display: flex;
            align-items: center;
            padding: 1.5rem;
            color: white;
        }
        
        @media (min-width: 768px) {
            .carousel-slide {
                height: 350px;
                padding: 2rem;
            }
        }
        
        .carousel-content {
            display: flex;
            align-items: center;
            width: 100%;
            z-index: 5;
            gap: 1rem;
        }
        
        @media (max-width: 767px) {
            .carousel-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
        }
        
        .carousel-image {
            width: 8rem;
            height: 8rem;
            border-radius: 1rem;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .carousel-image {
                width: 10rem;
                height: 10rem;
            }
        }
        
        .carousel-logo {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.5);
            opacity: 0.8;
            z-index: 10;
        }
        
        /* Estilos para tarjetas */
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        /* Grid responsivo */
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        @media (max-width: 640px) {
            .grid-4 {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
        
        /* Botones */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-danger {
            background-color: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
        }
        
        /* Filtros de categor√≠as */
        .category-btn {
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            border: 2px solid #e5e7eb;
            background: white;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .category-btn:hover {
            border-color: #dc2626;
            color: #dc2626;
        }
        
        .category-btn.active {
            background-color: #dc2626;
            border-color: #dc2626;
            color: white;
        }
        
        /* Animaciones */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #dc2626;
            border-radius: 50%;
            width: 3rem;
            height: 3rem;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        /* Notificaciones */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            z-index: 1001;
            transition: opacity 0.3s ease;
        }
        
        .notification.success {
            background-color: #16a34a;
        }
        
        .notification.error {
            background-color: #dc2626;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 32rem;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            background: #dc2626;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 1rem 1rem 0 0;
        }
        
        /* Formulario */
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        /* Breadcrumbs */
        .breadcrumb {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .breadcrumb a {
            color: #3b82f6;
            text-decoration: none;
            cursor: pointer;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header id="header-principal" class="header-dynamic bg-gradient-to-r from-red-600 to-red-500 text-white py-4 mb-6 shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <!-- Desktop/Tablet Layout -->
            <div class="hidden md:flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div id="logo-container-desktop" class="w-16 h-16 rounded-full overflow-hidden border-3 border-white border-opacity-30 hidden">
                        <img id="logo-negocio-desktop" src="" alt="Logo" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold" id="header-title-desktop">üöö Sistema de Deliverys</h1>
                        <p class="mt-2 opacity-90" id="header-slogan-desktop">Los mejores sabores a tu puerta</p>
                    </div>
                </div>
                
                <!-- Botones de navegaci√≥n desktop -->
                <div class="flex items-center space-x-4">
                    <button id="btn-compartir-desktop" onclick="compartirEnlace()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors hidden">
                        üì§ Compartir
                    </button>
                    <span id="usuario-logueado-desktop" class="text-sm text-white bg-green-600 px-3 py-2 rounded-lg hidden"></span>
                    <button id="btn-login-desktop" onclick="mostrarLogin()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        üë§ Login
                    </button>
                    <button id="btn-logout-desktop" onclick="cerrarSesion()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors hidden">
                        üö™ Salir
                    </button>
                </div>
            </div>

            <!-- Mobile Layout -->
            <div class="md:hidden">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div id="logo-container-mobile" class="w-10 h-10 rounded-full overflow-hidden border-2 border-white border-opacity-30 hidden">
                            <img id="logo-negocio-mobile" src="" alt="Logo" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h1 class="text-lg font-bold" id="header-title-mobile">üöö Sistema de Deliverys</h1>
                            <p class="text-sm opacity-90" id="header-slogan-mobile">Los mejores sabores a tu puerta</p>
                        </div>
                    </div>
                    
                    <!-- Bot√≥n de men√∫ m√≥vil -->
                    <button id="btn-menu-mobile" onclick="toggleMenuMobile()" class="bg-white bg-opacity-20 text-white p-2 rounded-full">
                        ‚ò∞
                    </button>
                </div>
                
                <!-- Navbar circular m√≥vil (inicialmente oculto) -->
                <div id="mobile-navbar" class="mobile-navbar hidden">
                    <button id="btn-compartir-mobile" onclick="compartirEnlace()" class="bg-blue-600 text-white hidden">
                        üì§
                    </button>
                    <button id="btn-login-mobile" onclick="mostrarLogin()" class="bg-gray-600 text-white">
                        üë§
                    </button>
                    <button id="btn-logout-mobile" onclick="cerrarSesion()" class="bg-red-600 text-white hidden">
                        üö™
                    </button>
                    <span id="usuario-logueado-mobile" class="text-xs text-white bg-green-600 px-2 py-1 rounded-full hidden"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal de Login -->
    <div id="modal-login" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-screen overflow-y-auto">
            <div id="modal-header-login" class="bg-red-600 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold">üîê Iniciar Sesi√≥n</h3>
                <button onclick="cerrarLogin()" class="text-white hover:text-gray-200 text-2xl font-bold">&times;</button>
            </div>
            <div class="p-6">
                <!-- Informaci√≥n del administrador/delivery/negocio -->
                <div id="info-contacto-login" class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3 mb-3">
                        <div id="logo-login" class="w-12 h-12 rounded-full overflow-hidden bg-gray-200">
                            <img id="img-logo-login" src="" alt="Logo" class="w-full h-full object-cover hidden">
                            <div id="placeholder-logo-login" class="w-full h-full flex items-center justify-center text-2xl">üè¢</div>
                        </div>
                        <div>
                            <h4 id="nombre-login" class="font-bold text-gray-800">RMPOS</h4>
                            <p id="slogan-login" class="text-sm text-gray-600">Plataformas personalizadas a tu medida</p>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1">
                        <p id="email-login">üìß rmpos.hn@gmail.com</p>
                        <p id="telefono-login">üìû +50493593126</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Usuario:</label>
                        <input type="text" id="input-usuario" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="Ingresa tu usuario">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a:</label>
                        <input type="password" id="input-clave" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="Ingresa tu contrase√±a">
                    </div>
                    <button onclick="validarLogin()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                        Ingresar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla de acceso restringido -->
    <div id="pantalla-acceso-restringido" class="hidden">
        <div class="max-w-7xl mx-auto px-4 pt-16">
            <div class="text-center">
                <div class="text-6xl mb-4">üîí</div>
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Acceso Restringido</h2>
                <p class="text-gray-600 mb-8">Para acceder al sistema, debes iniciar sesi√≥n o usar un enlace directo de delivery/negocio.</p>
                <button onclick="mostrarLogin()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    üë§ Iniciar Sesi√≥n
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4" id="contenido-principal">
        <!-- Vista de Deliverys (Solo Admin) -->
        <div id="vista-deliverys" class="hidden">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                <h2 class="text-2xl font-bold mb-2 sm:mb-0 text-gray-800">üöö Gesti√≥n de Deliverys</h2>
            </div>
            <div id="deliverys-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Los deliverys se cargar√°n din√°micamente -->
            </div>
        </div>

        <!-- Carrusel de Promociones -->
        <div id="seccion-promociones" class="mb-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">üéâ Promociones Especiales</h2>
            <div class="carousel-container">
                <div id="carrusel-promociones" class="flex transition-transform duration-500 ease-in-out">
                    <!-- Las promociones se cargar√°n din√°micamente -->
                </div>
                
                <!-- Controles del carrusel -->
                <button onclick="cambiarSlide(-1)" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl transition-all duration-300">
                    &#8249;
                </button>
                <button onclick="cambiarSlide(1)" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl transition-all duration-300">
                    &#8250;
                </button>
                
                <!-- Indicadores -->
                <div id="carousel-indicators" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2">
                    <!-- Los indicadores se generar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Filtros de categor√≠as -->
        <div id="seccion-filtros" class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4">
                <h2 class="text-xl font-bold mb-2 sm:mb-0 text-gray-800">Categor√≠as</h2>
                <!-- Breadcrumb junto a categor√≠as -->
                <div id="breadcrumb-categorias" class="breadcrumb hidden">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
            <div class="flex flex-wrap gap-3 mb-8" id="filtros-categorias">
                <!-- Las categor√≠as se cargar√°n din√°micamente -->
            </div>
        </div>

        <!-- Grid de negocios -->
        <div id="negocios-container" class="mb-8">
            <!-- Los negocios se cargar√°n din√°micamente -->
        </div>

        <!-- Grid de productos (cuando se selecciona un negocio) -->
        <div id="productos-container" class="hidden mb-8">
            <!-- Los productos se cargar√°n din√°micamente organizados por categor√≠as -->
        </div>

        <!-- Breadcrumb de navegaci√≥n inferior -->
        <div id="breadcrumb-inferior" class="breadcrumb hidden mt-8 pt-8 border-t border-gray-200">
            <!-- Se llenar√° din√°micamente -->
        </div>
    </div>

    <!-- Botones flotantes -->
    <!-- Bot√≥n del carrito -->
    <button id="carrito-flotante" onclick="abrirModal()" class="fixed bottom-20 right-4 w-14 h-14 bg-red-600 hover:bg-red-700 text-white rounded-full shadow-lg hover:scale-110 transition-all duration-300 z-50 hidden">
        <div class="relative">
            <span class="text-xl">üõí</span>
            <span id="contador-carrito" class="absolute -top-2 -right-2 bg-yellow-400 text-black text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </div>
    </button>

    <!-- Bot√≥n de WhatsApp -->
    <a id="whatsapp-flotante" href="#" target="_blank" class="fixed bottom-4 right-4 w-14 h-14 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-lg hover:scale-110 transition-all duration-300 z-50 flex items-center justify-center">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
        </svg>
    </a>

    <!-- Modal del carrito -->
    <div id="modal-carrito" class="modal hidden">
        <div class="modal-content" style="max-width: 32rem;">
            <!-- Header del modal -->
            <div class="modal-header">
                <h3 class="text-lg font-bold">üõí Tu Pedido</h3>
                <div class="flex items-center space-x-2">
                    <button onclick="vaciarCarrito()" class="btn btn-danger" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">
                        Vaciar
                    </button>
                    <button onclick="cerrarModal()" class="btn btn-danger" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">
                        Cerrar
                    </button>
                </div>
            </div>
            
            <!-- Contenido del carrito (scrollable) -->
            <div class="p-4" style="flex: 1; overflow-y: auto; max-height: 60vh;">
                <div id="items-carrito-modal" class="space-y-4 mb-4"></div>
                <div id="carrito-vacio" class="text-center py-8" style="color: #6b7280;">
                    Tu carrito est√° vac√≠o
                </div>
            </div>
            
            <!-- Footer del modal (fixed) -->
            <div id="footer-carrito" class="hidden" style="border-top: 1px solid #e5e7eb; padding: 1rem;">
                <div class="flex justify-between items-center font-bold mb-4">
                    <span>Total:</span>
                    <span id="total-carrito-modal">LPS. 0.00</span>
                </div>
                
                <!-- Formulario de datos del cliente -->
                <div class="mb-4 space-y-4">
                    <!-- Tipo de pedido -->
                    <select id="tipo-pedido" onchange="actualizarCamposFormulario()" class="form-input">
                        <option value="domicilio">üöö Env√≠o a domicilio</option>
                        <option value="llevar">ü•° Para llevar</option>
                        <option value="restaurante">üçΩÔ∏è Comer en restaurante</option>
                    </select>
                    
                    <!-- Nombre (siempre obligatorio) -->
                    <input type="text" id="nombre-cliente" class="form-input" placeholder="Tu nombre completo *">
                    
                    <!-- Tel√©fono (obligatorio para domicilio y llevar) -->
                    <div id="campo-telefono">
                        <input type="tel" id="telefono-cliente" class="form-input" placeholder="Tu n√∫mero de tel√©fono *">
                    </div>
                    
                    <!-- Direcci√≥n (solo para domicilio) -->
                    <div id="campo-direccion">
                        <div style="position: relative;">
                            <textarea id="direccion-cliente" class="form-input" rows="2" placeholder="Tu direcci√≥n completa *"></textarea>
                            <button type="button" onclick="obtenerUbicacion()" style="position: absolute; top: 0.5rem; right: 0.5rem; background: #3b82f6; color: white; border: none; border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.75rem; cursor: pointer;" title="Obtener mi ubicaci√≥n">üìç GPS</button>
                        </div>
                        <div id="estado-ubicacion" style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;"></div>
                    </div>
                    
                    <!-- N√∫mero de mesa (solo para restaurante) -->
                    <div id="campo-mesa" class="hidden">
                        <input type="number" id="mesa-cliente" class="form-input" placeholder="N√∫mero de mesa (opcional)" min="1">
                    </div>
                </div>
                
                <!-- Checkbox para notificar al comercio -->
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="notificar-comercio" checked style="margin-right: 0.5rem;">
                        <span style="font-size: 0.875rem; color: #374151;">Tambi√©n notificar al comercio</span>
                    </label>
                </div>
                
                <button onclick="enviarPorWhatsApp()" class="btn" style="width: 100%; background-color: #16a34a; color: white; display: flex; align-items: center; justify-content: center;">
                    <svg style="width: 1rem; height: 1rem; margin-right: 0.5rem;" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                    </svg>
                    Enviar Pedido al Delivery
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="footer-principal" class="footer-dynamic bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold mb-4">¬°S√≠guenos en nuestras redes sociales!</h3>
                <div class="flex justify-center space-x-4" id="redes-sociales">
                    <!-- Las redes sociales se cargar√°n din√°micamente -->
                </div>
            </div>
            
            <div class="text-center border-t border-gray-700 pt-4">
                <p>&copy; 2024 Sistema de Deliverys. Todos los derechos reservados.</p>
                <p class="text-gray-400 mt-2" id="footer-contacto">
                    üìû Tel√©fono: (504) 2234-5678 | üìß Email: info@deliverys.com
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Variables globales
        let carrito = [];
        let total = 0;
        let categoriaActual = 'todas';
        let slideActual = 0;
        let totalSlides = 0;
        let usuarioActual = null;
        let deliveryActual = null;
        let negocioActual = null;
        let vistaActual = 'negocios';
        let datosAdmin = null;
        let ubicacionCliente = null;
        
        // Variables para datos din√°micos
        let deliverys = [];
        let negocios = [];
        let categoriasNegocios = [];
        let categorias = [];
        let promociones = [];
        let productos = [];
        let opciones = [];
        let tiposOpciones = [];
        let usuarios = [];
        
        // ID del Google Sheets
        const SHEET_ID = '1ApDsUMZCzHacOcpn6HtmxDsIyeae5osK6StuZP9PQxE';
        
        // URLs de OpenSheets API (para datos p√∫blicos)
        const API_URLS = {
            deliverys: `https://opensheet.elk.sh/${SHEET_ID}/Deliverys`,
            negocios: `https://opensheet.elk.sh/${SHEET_ID}/Negocios`,
            categoriasNegocios: `https://opensheet.elk.sh/${SHEET_ID}/CategoriasNegocios`,
            categorias: `https://opensheet.elk.sh/${SHEET_ID}/Categorias`,
            promociones: `https://opensheet.elk.sh/${SHEET_ID}/Promociones`,
            productos: `https://opensheet.elk.sh/${SHEET_ID}/Productos`,
            opciones: `https://opensheet.elk.sh/${SHEET_ID}/Opciones`,
            tiposOpciones: `https://opensheet.elk.sh/${SHEET_ID}/TiposOpciones`
        };
        
        // URL del Google Apps Script para autenticaci√≥n segura
        // Reemplaza esta URL con la URL de tu Google Apps Script desplegado
        const AUTH_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz4Xk2Rm-Iy1NPZTH-ypFPTldFxJ_JBLWDFY3xNB7nbRtJRrOKYOgcaLI9cy-gR2IQmiA/exec';

        // Funci√≥n principal para cargar todos los datos
        async function cargarDatosCompletos() {
            try {
                mostrarCargando(true);
                
                // Restaurar sesi√≥n si existe
                restaurarSesion();
                
                // Restaurar carrito si existe
                restaurarCarrito();
                
                // Cargar datos p√∫blicos en paralelo
                const [deliverysData, negociosData, categoriasNegociosData, categoriasData, promocionesData, productosData, opcionesData, tiposOpcionesData] = await Promise.all([
                    fetch(API_URLS.deliverys).then(r => r.json()),
                    fetch(API_URLS.negocios).then(r => r.json()),
                    fetch(API_URLS.categoriasNegocios).then(r => r.json()),
                    fetch(API_URLS.categorias).then(r => r.json()),
                    fetch(API_URLS.promociones).then(r => r.json()),
                    fetch(API_URLS.productos).then(r => r.json()),
                    fetch(API_URLS.opciones).then(r => r.json()),
                    fetch(API_URLS.tiposOpciones).then(r => r.json())
                ]);
                
                // Asignar datos a variables globales y filtrar solo los activos
                deliverys = (deliverysData || []).filter(item => item.estado === 'Activo');
                negocios = (negociosData || []).filter(item => item.estado === 'Activo');
                categoriasNegocios = (categoriasNegociosData || []).filter(item => item.estado === 'Activo');
                categorias = (categoriasData || []).filter(item => item.estado === 'Activo');
                promociones = (promocionesData || []).filter(item => item.estado === 'Activo');
                productos = (productosData || []).filter(item => item.estado === 'Activo');
                opciones = (opcionesData || []).filter(item => item.estado === 'Activo');
                tiposOpciones = (tiposOpcionesData || []).filter(item => item.estado === 'Activo');
                
                // Los usuarios se cargar√°n de forma segura solo cuando sea necesario
                usuarios = [];
                
                // Obtener datos del administrador del sistema (siempre usar datos de RMPOS)
                datosAdmin = {
                    nombre_completo: 'RMPOS',
                    nombre: 'RMPOS',
                    slogan: 'Plataformas personalizadas a tu medida',
                    telefono: '+50493593126',
                    email: 'rmpos.hn@gmail.com',
                    logo_url: 'https://github.com/rimedhn/rmpos/blob/main/LOGO%20RMPOS.jpg?raw=true',
                    facebook_url: 'https://www.facebook.com/profile.php?id=',
                    instagram_url: 'https://www.instagram.com/rmposhn/',
                    tiktok_url: 'https://www.tiktok.com/@rimeddigital'
                };
                
                // Procesar par√°metros de URL
                const accesoPermitido = procesarParametrosURL();
                
                // Verificar control de acceso
                if (!accesoPermitido && !usuarioActual) {
                    mostrarPantallaAccesoRestringido();
                    mostrarCargando(false);
                    return;
                }
                
                // Procesar y organizar opciones por producto
                procesarOpciones();
                
                // Renderizar contenido seg√∫n el contexto
                renderizarContenido();
                
                mostrarCargando(false);
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                // Solo mostrar error si realmente no se cargaron datos
                if (!deliverys.length && !negocios.length) {
                    mostrarError('Error al cargar los datos. Por favor, recarga la p√°gina.');
                }
                mostrarCargando(false);
            }
        }
        
        // Procesar par√°metros de URL y verificar acceso
        function procesarParametrosURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const deliveryId = urlParams.get('delivery');
            const negocioId = urlParams.get('negocio');
            
            // Guardar contexto de URL para validaciones de login
            window.contextoURL = {
                esEnlaceGeneral: !deliveryId && !negocioId,
                esEnlaceDelivery: deliveryId && !negocioId,
                esEnlaceNegocio: deliveryId && negocioId,
                deliveryId: deliveryId,
                negocioId: negocioId
            };
            
            if (deliveryId) {
                deliveryActual = deliverys.find(d => d.id == deliveryId);
                if (deliveryActual) {
                    if (negocioId) {
                        negocioActual = negocios.find(n => n.id == negocioId && n.delivery_id == deliveryId);
                        if (negocioActual) {
                            vistaActual = 'productos';
                        }
                    } else {
                        vistaActual = 'negocios';
                    }
                    return true; // Acceso permitido con enlace directo
                }
            }
            
            return false; // Acceso no permitido sin enlace directo
        }
        
        // Mostrar pantalla de acceso restringido
        function mostrarPantallaAccesoRestringido() {
            document.getElementById('pantalla-acceso-restringido').classList.remove('hidden');
            document.getElementById('contenido-principal').classList.add('hidden');
            document.getElementById('seccion-promociones').classList.add('hidden');
        }
        
        // Ocultar pantalla de acceso restringido
        function ocultarPantallaAccesoRestringido() {
            document.getElementById('pantalla-acceso-restringido').classList.add('hidden');
            document.getElementById('contenido-principal').classList.remove('hidden');
        }
        
        // Renderizar contenido seg√∫n el contexto
        function renderizarContenido() {
            if (usuarioActual) {
                ocultarPantallaAccesoRestringido();
                renderizarPanelAdmin();
            } else if (negocioActual) {
                ocultarPantallaAccesoRestringido();
                renderizarMenuNegocio();
            } else if (deliveryActual) {
                ocultarPantallaAccesoRestringido();
                renderizarNegociosDelivery();
            } else {
                // Vista por defecto - mostrar primer delivery o mensaje
                if (deliverys.length > 0) {
                    deliveryActual = deliverys[0];
                    ocultarPantallaAccesoRestringido();
                    renderizarNegociosDelivery();
                } else {
                    mostrarMensajeSinDatos();
                }
            }
        }
        
        // Renderizar panel de administraci√≥n
        function renderizarPanelAdmin() {
            const vistaDeliverys = document.getElementById('vista-deliverys');
            const seccionPromociones = document.getElementById('seccion-promociones');
            const seccionFiltros = document.getElementById('seccion-filtros');
            const negociosContainer = document.getElementById('negocios-container');
            const productosContainer = document.getElementById('productos-container');
            
            if (usuarioActual.tipo === 'Admin') {
                // Admin ve todos los deliverys
                vistaDeliverys.classList.remove('hidden');
                seccionPromociones.classList.add('hidden');
                seccionFiltros.classList.add('hidden');
                negociosContainer.classList.add('hidden');
                productosContainer.classList.add('hidden');
                
                renderizarDeliverys();
                actualizarFooterContacto(datosAdmin, datosAdmin.telefono);
                actualizarWhatsAppFlotante(datosAdmin.telefono);
            } else if (usuarioActual.tipo === 'Delivery') {
                // Delivery ve sus negocios
                deliveryActual = deliverys.find(d => d.id == usuarioActual.delivery_id);
                if (deliveryActual) {
                    renderizarNegociosDelivery();
                    actualizarFooterContacto(deliveryActual, deliveryActual.telefono);
                    actualizarWhatsAppFlotante(deliveryActual.telefono);
                }
            } else if (usuarioActual.tipo === 'Comercio') {
                // Comercio ve su men√∫
                negocioActual = negocios.find(n => n.id == usuarioActual.negocio_id);
                if (negocioActual) {
                    deliveryActual = deliverys.find(d => d.id == negocioActual.delivery_id);
                    renderizarMenuNegocio();
                    actualizarFooterContacto(negocioActual, negocioActual.telefono);
                    actualizarWhatsAppFlotante(deliveryActual.telefono);
                }
            }
        }
        
        // Renderizar deliverys (solo para Admin)
        function renderizarDeliverys() {
            const container = document.getElementById('deliverys-container');
            container.innerHTML = '';
            
            deliverys.forEach(delivery => {
                const deliveryCard = crearTarjetaDelivery(delivery);
                container.appendChild(deliveryCard);
            });
            
            // Actualizar header con datos de RMPOS para admin
            actualizarHeader(datosAdmin.nombre, datosAdmin.slogan);
            actualizarBreadcrumbs();
        }
        
        // Crear tarjeta de delivery
        function crearTarjetaDelivery(delivery) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-1 overflow-hidden';
            
            card.innerHTML = `
                <div class="relative h-48">
                    ${delivery.imagen_url ? 
                        `<img src="${delivery.imagen_url}" alt="${delivery.nombre}" class="w-full h-full object-cover">` :
                        `<div class="w-full h-full bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">
                            <div class="text-center text-white">
                                <div class="text-6xl mb-2">üöö</div>
                                <div class="text-lg font-semibold">${delivery.nombre}</div>
                            </div>
                        </div>`
                    }
                    ${delivery.logo_url ? 
                        `<div class="absolute top-2 left-2">
                            <img src="${delivery.logo_url}" alt="Logo ${delivery.nombre}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md">
                        </div>` : ''
                    }
                </div>
                <div class="p-4">
                    <h3 class="text-xl font-bold mb-2 text-gray-800">${delivery.nombre}</h3>
                    <p class="text-gray-600 mb-4">${delivery.descripcion || delivery.slogan || 'Delivery de comida'}</p>
                    <div class="flex justify-between items-center">
                        <button onclick="verNegociosDelivery(${delivery.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-md text-sm font-medium transition-colors">
                            Ver Negocios
                        </button>
                        <button onclick="compartirDelivery(${delivery.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md text-sm font-medium transition-colors">
                            üì§ Compartir
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Ver negocios de un delivery espec√≠fico
        function verNegociosDelivery(deliveryId) {
            deliveryActual = deliverys.find(d => d.id == deliveryId);
            if (deliveryActual) {
                vistaActual = 'negocios';
                renderizarNegociosDelivery();
                
                // Ocultar vista de deliverys
                document.getElementById('vista-deliverys').classList.add('hidden');
                
                // Actualizar footer seg√∫n tipo de usuario
                if (usuarioActual && usuarioActual.tipo === 'Admin') {
                    actualizarFooterContacto(deliveryActual, deliveryActual.telefono);
                }
            }
        }
        
        // Renderizar negocios de un delivery
        function renderizarNegociosDelivery() {
            if (!deliveryActual) return;
            
            // Mostrar secciones relevantes
            document.getElementById('vista-deliverys').classList.add('hidden');
            document.getElementById('seccion-promociones').classList.remove('hidden');
            document.getElementById('seccion-filtros').classList.remove('hidden');
            document.getElementById('negocios-container').classList.remove('hidden');
            document.getElementById('productos-container').classList.add('hidden');
            
            // Filtrar y ordenar datos del delivery actual por prioridad
            const negociosDelivery = negocios
                .filter(n => n.delivery_id == deliveryActual.id)
                .sort((a, b) => (parseInt(a.prioridad) || 999) - (parseInt(b.prioridad) || 999));
            const promocionesDelivery = promociones.filter(p => 
                p.delivery_id == deliveryActual.id || 
                negociosDelivery.some(n => n.id == p.negocio_id)
            );
            
            // Actualizar header
            actualizarHeader(deliveryActual.nombre, deliveryActual.slogan || 'Los mejores sabores a tu puerta');
            
            // Renderizar componentes
            renderizarPromociones(promocionesDelivery);
            renderizarCategoriasNegocios();
            renderizarNegocios(negociosDelivery);
            
            // Actualizar breadcrumbs
            actualizarBreadcrumbs();
            
            // Actualizar bot√≥n compartir
            mostrarBotonesCompartir();
            
            // Actualizar WhatsApp flotante y footer
            actualizarWhatsAppFlotante(deliveryActual.telefono);
            if (!usuarioActual || usuarioActual.tipo === 'Comercio' || !usuarioActual.tipo) {
                actualizarFooterContacto(deliveryActual, deliveryActual.telefono);
            }
        }
        
        // Renderizar men√∫ de un negocio espec√≠fico
        function renderizarMenuNegocio() {
            if (!negocioActual || !deliveryActual) return;
            
            // Mostrar secciones relevantes
            document.getElementById('vista-deliverys').classList.add('hidden');
            document.getElementById('seccion-promociones').classList.remove('hidden');
            document.getElementById('seccion-filtros').classList.remove('hidden');
            document.getElementById('negocios-container').classList.add('hidden');
            document.getElementById('productos-container').classList.remove('hidden');
            
            // Filtrar datos del negocio actual
            const promocionesNegocio = promociones.filter(p => p.negocio_id == negocioActual.id);
            const categoriasNegocio = categorias.filter(c => 
                productos.some(p => p.negocio_id == negocioActual.id && p.categoria_id == c.id)
            );
            const productosNegocio = productos.filter(p => p.negocio_id == negocioActual.id);
            
            // Actualizar header
            actualizarHeader(negocioActual.nombre, negocioActual.descripcion || 'Men√∫ digital');
            
            // Renderizar componentes
            renderizarPromociones(promocionesNegocio);
            renderizarCategorias(categoriasNegocio);
            renderizarProductosPorCategorias(productosNegocio, categoriasNegocio);
            
            // Actualizar breadcrumbs
            actualizarBreadcrumbs();
            
            // Actualizar bot√≥n compartir
            mostrarBotonesCompartir();
            
            // Actualizar WhatsApp flotante y footer
            actualizarWhatsAppFlotante(deliveryActual.telefono);
            if (usuarioActual && usuarioActual.tipo === 'Delivery') {
                actualizarFooterContacto(negocioActual, negocioActual.telefono);
            } else if (!usuarioActual || usuarioActual.tipo === 'Comercio' || !usuarioActual.tipo) {
                actualizarFooterContacto(deliveryActual, deliveryActual.telefono);
            }
        }
        
        // Actualizar header din√°micamente
        function actualizarHeader(titulo, slogan) {
            // Desktop
            document.getElementById('header-title-desktop').textContent = titulo;
            document.getElementById('header-slogan-desktop').textContent = slogan;
            
            // Mobile
            document.getElementById('header-title-mobile').textContent = titulo;
            document.getElementById('header-slogan-mobile').textContent = slogan;
            
            // Actualizar logo y colores din√°micos
            let logoUrl = null;
            let entidadActual = null;
            
            if (negocioActual && negocioActual.logo_url) {
                logoUrl = negocioActual.logo_url;
                entidadActual = negocioActual;
            } else if (deliveryActual && deliveryActual.logo_url) {
                logoUrl = deliveryActual.logo_url;
                entidadActual = deliveryActual;
            } else if (datosAdmin && datosAdmin.logo_url) {
                logoUrl = datosAdmin.logo_url;
                entidadActual = datosAdmin;
            }
            
            const logoContainerDesktop = document.getElementById('logo-container-desktop');
            const logoImgDesktop = document.getElementById('logo-negocio-desktop');
            const logoContainerMobile = document.getElementById('logo-container-mobile');
            const logoImgMobile = document.getElementById('logo-negocio-mobile');
            
            if (logoUrl) {
                logoImgDesktop.src = logoUrl;
                logoImgMobile.src = logoUrl;
                
                logoImgDesktop.onerror = function() {
                    logoContainerDesktop.classList.add('hidden');
                };
                logoImgMobile.onerror = function() {
                    logoContainerMobile.classList.add('hidden');
                };
                
                logoContainerDesktop.classList.remove('hidden');
                logoContainerMobile.classList.remove('hidden');
                
                // Actualizar colores din√°micos basados en el logo
                actualizarColoresDinamicos(entidadActual);
            } else {
                logoContainerDesktop.classList.add('hidden');
                logoContainerMobile.classList.add('hidden');
                
                // Usar colores por defecto
                actualizarColoresDinamicos(datosAdmin);
            }
        }
        
        // Actualizar colores din√°micos del header y footer
        function actualizarColoresDinamicos(entidad) {
            const header = document.getElementById('header-principal');
            const footer = document.getElementById('footer-principal');
            const modalHeader = document.getElementById('modal-header-login');
            
            // Colores por defecto (RMPOS)
            let colorPrimario = 'from-red-600 to-red-500';
            let colorFooter = 'bg-gray-800';
            
            // Si la entidad tiene colores personalizados, usarlos
            if (entidad && entidad.color_primario) {
                colorPrimario = `from-${entidad.color_primario}-600 to-${entidad.color_primario}-500`;
            }
            if (entidad && entidad.color_secundario) {
                colorFooter = `bg-${entidad.color_secundario}-800`;
            }
            
            // Aplicar colores
            header.className = `header-dynamic bg-gradient-to-r ${colorPrimario} text-white py-4 mb-6 shadow-lg`;
            footer.className = `footer-dynamic ${colorFooter} text-white py-8 mt-12`;
            modalHeader.className = `bg-red-600 text-white p-4 flex justify-between items-center`;
        }
        
        // Actualizar breadcrumbs
        function actualizarBreadcrumbs() {
            const breadcrumbCategorias = document.getElementById('breadcrumb-categorias');
            const breadcrumbInferior = document.getElementById('breadcrumb-inferior');
            
            let breadcrumbHTML = '';
            
            // Verificar si llegamos por enlace directo de negocio
            const urlParams = new URLSearchParams(window.location.search);
            const negocioIdUrl = urlParams.get('negocio');
            const deliveryIdUrl = urlParams.get('delivery');
            
            if (usuarioActual && usuarioActual.tipo === 'Admin') {
                breadcrumbHTML += '<a onclick="volverADeliverys()" style="cursor: pointer;">üè† Panel Admin</a>';
                if (deliveryActual) {
                    breadcrumbHTML += ` > <a onclick="verNegociosDelivery(${deliveryActual.id})" style="cursor: pointer;">${deliveryActual.nombre}</a>`;
                }
                if (negocioActual) {
                    breadcrumbHTML += ` > <span style="color: #dc2626;">${negocioActual.nombre}</span>`;
                }
            } else if (negocioIdUrl && deliveryIdUrl) {
                // Enlace directo de negocio - solo mostrar el negocio
                if (negocioActual) {
                    breadcrumbHTML += `<span style="color: #dc2626;">üè™ ${negocioActual.nombre}</span>`;
                }
            } else if (deliveryIdUrl && !negocioIdUrl) {
                // Enlace directo de delivery - mostrar delivery y negocio si aplica
                if (deliveryActual) {
                    breadcrumbHTML += `<a onclick="volverANegocios()" style="cursor: pointer;">üè† ${deliveryActual.nombre}</a>`;
                }
                if (negocioActual) {
                    breadcrumbHTML += ` > <span style="color: #dc2626;">${negocioActual.nombre}</span>`;
                }
            } else {
                // Enlace general - mostrar todo
                if (deliveryActual) {
                    breadcrumbHTML += `<a onclick="volverANegocios()" style="cursor: pointer;">üè† ${deliveryActual.nombre}</a>`;
                }
                if (negocioActual) {
                    breadcrumbHTML += ` > <span style="color: #dc2626;">${negocioActual.nombre}</span>`;
                }
            }
            
            if (breadcrumbHTML) {
                if (breadcrumbCategorias) {
                    breadcrumbCategorias.innerHTML = breadcrumbHTML;
                    breadcrumbCategorias.classList.remove('hidden');
                }
                if (breadcrumbInferior) {
                    breadcrumbInferior.innerHTML = breadcrumbHTML;
                    breadcrumbInferior.classList.remove('hidden');
                }
            } else {
                if (breadcrumbCategorias) breadcrumbCategorias.classList.add('hidden');
                if (breadcrumbInferior) breadcrumbInferior.classList.add('hidden');
            }
        }
        
        // Volver a vista de deliverys
        function volverADeliverys() {
            if (usuarioActual && usuarioActual.tipo === 'Admin') {
                deliveryActual = null;
                negocioActual = null;
                vistaActual = 'deliverys';
                categoriaActual = 'todas';
                
                // Mostrar vista de deliverys y ocultar otras
                document.getElementById('vista-deliverys').classList.remove('hidden');
                document.getElementById('seccion-promociones').classList.add('hidden');
                document.getElementById('seccion-filtros').classList.add('hidden');
                document.getElementById('negocios-container').classList.add('hidden');
                document.getElementById('productos-container').classList.add('hidden');
                
                renderizarDeliverys();
            }
        }
        
        // Volver a vista de negocios
        function volverANegocios() {
            negocioActual = null;
            vistaActual = 'negocios';
            categoriaActual = 'todas';
            renderizarNegociosDelivery();
        }
        
        // Mostrar botones compartir
        function mostrarBotonesCompartir() {
            // Desktop
            const btnCompartirDesktop = document.getElementById('btn-compartir-desktop');
            if (btnCompartirDesktop) {
                btnCompartirDesktop.classList.remove('hidden');
            }
            // Mobile
            const btnCompartirMobile = document.getElementById('btn-compartir-mobile');
            if (btnCompartirMobile) {
                btnCompartirMobile.classList.remove('hidden');
            }
        }
        
        // Ocultar botones compartir
        function ocultarBotonesCompartir() {
            // Desktop
            document.getElementById('btn-compartir-desktop').classList.add('hidden');
            // Mobile
            document.getElementById('btn-compartir-mobile').classList.add('hidden');
        }
        
        // Renderizar promociones con logos mejorados
        function renderizarPromociones(promocionesData) {
            const carruselContainer = document.getElementById('carrusel-promociones');
            const indicadoresContainer = document.getElementById('carousel-indicators');
            
            if (!carruselContainer) return;
            
            carruselContainer.innerHTML = '';
            indicadoresContainer.innerHTML = '';
            
            totalSlides = promocionesData.length;
            
            if (totalSlides === 0) {
                document.getElementById('seccion-promociones').classList.add('hidden');
                return;
            }
            
            document.getElementById('seccion-promociones').classList.remove('hidden');
            
            promocionesData.forEach((promocion, index) => {
                // Crear slide de promoci√≥n
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                
                const colorInicio = promocion.color_ini || '#ef4444';
                const colorFin = promocion.color_fin || '#f97316';
                
                // Determinar qu√© logo usar
                let logoUrl = null;
                let nombreEntidad = '';
                
                if (promocion.negocio_id) {
                    const negocio = negocios.find(n => n.id == promocion.negocio_id);
                    if (negocio) {
                        logoUrl = negocio.logo_url;
                        nombreEntidad = negocio.nombre;
                    }
                } else if (promocion.delivery_id) {
                    const delivery = deliverys.find(d => d.id == promocion.delivery_id);
                    if (delivery) {
                        logoUrl = delivery.logo_url;
                        nombreEntidad = delivery.nombre;
                    }
                }
                
                slide.style.background = `linear-gradient(135deg, ${colorInicio}, ${colorFin})`;
                
                slide.innerHTML = `
                    <div class="carousel-content">
                        <div>
                            ${promocion.imagen_url ? 
                                `<img src="${promocion.imagen_url}" alt="${promocion.titulo}" class="carousel-image">` :
                                `<div style="width: 8rem; height: 8rem; background: rgba(255,255,255,0.2); border-radius: 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem; flex-shrink: 0;">üéâ</div>`
                            }
                        </div>
                        <div style="flex: 1;">
                            <h3 class="text-2xl font-bold mb-2">${promocion.titulo}</h3>
                            <p class="text-lg mb-4">${promocion.detalle}</p>
                            ${nombreEntidad ? `<p style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 1rem;">üìç ${nombreEntidad}</p>` : ''}
                            ${promocion.ahorro ? 
                                `<div style="background: white; color: #374151; padding: 0.5rem 1rem; border-radius: 50px; display: inline-block; font-weight: bold;">
                                    ${promocion.ahorro}
                                </div>` : ''
                            }
                        </div>
                    </div>
                    ${logoUrl ? 
                        `<img src="${logoUrl}" alt="Logo ${nombreEntidad}" class="carousel-logo">` : ''
                    }
                `;
                
                carruselContainer.appendChild(slide);
                
                // Crear indicador
                const indicador = document.createElement('button');
                indicador.onclick = () => irASlide(index);
                indicador.style.cssText = `
                    width: 0.75rem; 
                    height: 0.75rem; 
                    border-radius: 50%; 
                    border: none; 
                    background: ${index === 0 ? 'white' : 'rgba(255,255,255,0.5)'}; 
                    cursor: pointer; 
                    transition: all 0.3s ease;
                `;
                indicador.id = `indicador-${index}`;
                indicadoresContainer.appendChild(indicador);
            });
            
            // Reiniciar carrusel
            slideActual = 0;
            actualizarCarrusel();
        }
        
        // Renderizar categor√≠as de negocios
        function renderizarCategoriasNegocios() {
            const contenedorFiltros = document.getElementById('filtros-categorias');
            if (!contenedorFiltros) return;
            
            contenedorFiltros.innerHTML = '';
            
            // Agregar bot√≥n "Todas"
            const btnTodas = document.createElement('button');
            btnTodas.onclick = () => filtrarCategoriaNegocio('todas');
            btnTodas.className = 'category-btn active';
            btnTodas.textContent = 'Todas';
            contenedorFiltros.appendChild(btnTodas);
            
            // Agregar categor√≠as din√°micas
            categoriasNegocios.forEach(categoria => {
                const btn = document.createElement('button');
                btn.onclick = () => filtrarCategoriaNegocio(categoria.id);
                btn.className = 'category-btn';
                btn.textContent = `${categoria.icono} ${categoria.nombre}`;
                contenedorFiltros.appendChild(btn);
            });
        }
        
        // Renderizar categor√≠as de productos
        function renderizarCategorias(categoriasData) {
            const contenedorFiltros = document.getElementById('filtros-categorias');
            if (!contenedorFiltros) return;
            
            contenedorFiltros.innerHTML = '';
            
            // Agregar bot√≥n "Todas"
            const btnTodas = document.createElement('button');
            btnTodas.onclick = () => filtrarCategoria('todas');
            btnTodas.className = 'category-btn active';
            btnTodas.textContent = 'Todas';
            contenedorFiltros.appendChild(btnTodas);
            
            // Agregar categor√≠as din√°micas
            categoriasData.forEach(categoria => {
                const btn = document.createElement('button');
                btn.onclick = () => filtrarCategoria(categoria.id);
                btn.className = 'category-btn';
                btn.textContent = `${categoria.icono} ${categoria.nombre}`;
                contenedorFiltros.appendChild(btn);
            });
        }
        
        // Renderizar negocios
        function renderizarNegocios(negociosData) {
            const negociosContainer = document.getElementById('negocios-container');
            if (!negociosContainer) return;
            
            negociosContainer.innerHTML = '';
            
            let negociosFiltrados = negociosData;
            if (categoriaActual !== 'todas') {
                negociosFiltrados = negociosData.filter(n => n.categoria_negocio_id == categoriaActual);
            }
            
            const grid = document.createElement('div');
            grid.className = 'grid grid-4';
            
            negociosFiltrados.forEach(negocio => {
                const negocioCard = crearTarjetaNegocio(negocio);
                grid.appendChild(negocioCard);
            });
            
            negociosContainer.appendChild(grid);
        }
        
        // Crear tarjeta de negocio
        function crearTarjetaNegocio(negocio) {
            const categoria = categoriasNegocios.find(c => c.id == negocio.categoria_negocio_id);
            
            const card = document.createElement('div');
            card.className = 'card';
            
            card.innerHTML = `
                <div style="position: relative; height: 12rem;">
                    ${negocio.imagen_url ? 
                        `<img src="${negocio.imagen_url}" alt="${negocio.nombre}" class="card-image">` :
                        `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #e5e7eb, #9ca3af); display: flex; align-items: center; justify-content: center;">
                            <div class="text-center">
                                <div style="font-size: 4rem; margin-bottom: 0.5rem;">${categoria ? categoria.icono : 'üè™'}</div>
                                <div style="font-size: 0.875rem; font-weight: 600; color: #374151;">${negocio.nombre}</div>
                            </div>
                        </div>`
                    }
                    ${negocio.logo_url ? 
                        `<div style="position: absolute; top: 0.5rem; left: 0.5rem;">
                            <img src="${negocio.logo_url}" alt="Logo ${negocio.nombre}" style="width: 3rem; height: 3rem; border-radius: 50%; object-fit: cover; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        </div>` : ''
                    }
                </div>
                <div class="card-content">
                    <h3 class="text-xl font-bold mb-2" style="color: #374151;">${negocio.nombre}</h3>
                    <p style="color: #6b7280; margin-bottom: 1rem;">${negocio.descripcion || 'Deliciosa comida te espera'}</p>
                    <div class="flex justify-between items-center">
                        <button onclick="verMenuNegocio(${negocio.id})" class="btn btn-danger">
                            Ver Men√∫
                        </button>
                        <button onclick="compartirNegocio(${negocio.id})" class="btn btn-primary">
                            üì§ Compartir
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Ver men√∫ de un negocio espec√≠fico
        function verMenuNegocio(negocioId) {
            negocioActual = negocios.find(n => n.id == negocioId);
            if (negocioActual) {
                if (!deliveryActual) {
                    deliveryActual = deliverys.find(d => d.id == negocioActual.delivery_id);
                }
                vistaActual = 'productos';
                renderizarMenuNegocio();
            }
        }
        
        // Renderizar productos por categor√≠as
        function renderizarProductosPorCategorias(productosData, categoriasData) {
            const productosContainer = document.getElementById('productos-container');
            if (!productosContainer) return;
            
            productosContainer.innerHTML = '';
            
            if (categoriaActual === 'todas') {
                // Mostrar productos organizados por categor√≠as
                categoriasData.forEach(categoria => {
                    const productosCategoria = productosData.filter(p => p.categoria_id == categoria.id);
                    
                    if (productosCategoria.length > 0) {
                        // Crear secci√≥n de categor√≠a
                        const seccionCategoria = document.createElement('div');
                        seccionCategoria.style.marginBottom = '3rem';
                        seccionCategoria.innerHTML = `
                            <h3 class="text-2xl font-bold mb-6 flex items-center" style="color: #374151;">
                                <span style="font-size: 2rem; margin-right: 0.75rem;">${categoria.icono}</span>
                                ${categoria.nombre}
                            </h3>
                            <div class="grid grid-4" id="categoria-${categoria.id}">
                            </div>
                        `;
                        
                        productosContainer.appendChild(seccionCategoria);
                        
                        // Agregar productos a esta categor√≠a
                        const gridCategoria = document.getElementById(`categoria-${categoria.id}`);
                        productosCategoria.forEach((producto, index) => {
                            const productoCard = crearTarjetaProducto(producto, index);
                            gridCategoria.appendChild(productoCard);
                        });
                    }
                });
            } else {
                // Mostrar solo productos de la categor√≠a seleccionada
                const productosCategoria = productosData.filter(p => p.categoria_id == categoriaActual);
                const categoria = categoriasData.find(c => c.id == categoriaActual);
                
                if (productosCategoria.length > 0) {
                    const seccionCategoria = document.createElement('div');
                    seccionCategoria.innerHTML = `
                        <h3 class="text-2xl font-bold mb-6 flex items-center" style="color: #374151;">
                            <span style="font-size: 2rem; margin-right: 0.75rem;">${categoria ? categoria.icono : 'üçΩÔ∏è'}</span>
                            ${categoria ? categoria.nombre : 'Productos'}
                        </h3>
                        <div class="grid grid-4" id="productos-filtrados">
                        </div>
                    `;
                    
                    productosContainer.appendChild(seccionCategoria);
                    
                    const gridFiltrado = document.getElementById('productos-filtrados');
                    productosCategoria.forEach((producto, index) => {
                        const productoCard = crearTarjetaProducto(producto, index);
                        gridFiltrado.appendChild(productoCard);
                    });
                }
            }
        }
        
        // Crear tarjeta de producto
        function crearTarjetaProducto(producto, index) {
            const categoria = categorias.find(c => c.id == producto.categoria_id);
            
            const productoCard = document.createElement('div');
            productoCard.className = 'card';
            productoCard.style.display = 'flex';
            productoCard.style.flexDirection = 'column';
            
            productoCard.innerHTML = `
                <div style="position: relative; height: 12rem;">
                    ${producto.imagen_url ? 
                        `<img src="${producto.imagen_url}" alt="${producto.nombre}" class="card-image">` :
                        `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #e5e7eb, #9ca3af); display: flex; align-items: center; justify-content: center;">
                            <div class="text-center">
                                <div style="font-size: 4rem; margin-bottom: 0.5rem;">${categoria ? categoria.icono : 'üçΩÔ∏è'}</div>
                                <div style="font-size: 0.875rem; font-weight: 600; color: #374151;">${producto.nombre}</div>
                            </div>
                        </div>`
                    }
                </div>
                <div class="card-content" style="display: flex; flex-direction: column; flex: 1;">
                    <div style="flex: 1;">
                        <h2 class="text-xl font-bold mb-2" style="color: #374151;">${producto.nombre.toUpperCase()}</h2>
                        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem;">${producto.descripcion}</p>
                    </div>
                    <div style="margin-top: auto; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold" style="color: #111827;">Desde LPS. ${parseFloat(producto.precio_base).toFixed(2)}</span>
                        </div>
                        <div class="flex items-center justify-between" style="gap: 0.5rem;">
                            <div class="flex items-center" style="gap: 0.5rem;">
                                <label style="font-size: 0.875rem; font-weight: 500; color: #374151;">CANTIDAD:</label>
                                <input type="number" id="quantity-${producto.id}-${index}" value="1" min="1" style="width: 4rem; padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; text-align: center;">
                            </div>
                            <button onclick="ordenarProducto('${producto.nombre}', ${producto.precio_base}, 'quantity-${producto.id}-${index}')" class="btn" style="background-color: #16a34a; color: white; font-weight: 600; flex-shrink: 0;">ORDENAR</button>
                        </div>
                    </div>
                </div>
            `;
            
            return productoCard;
        }
        
        // Procesar opciones y organizarlas por producto
        function procesarOpciones() {
            window.productosOpciones = {};
            
            productos.forEach(producto => {
                const opcionesProducto = opciones.filter(op => op.producto_id == producto.id);
                
                if (opcionesProducto.length > 0) {
                    window.productosOpciones[producto.nombre] = {};
                    
                    // Agrupar opciones por tipo din√°micamente
                    tiposOpciones.forEach(tipoOpcion => {
                        const opcionesTipo = opcionesProducto.filter(op => op.tipo === tipoOpcion.nombre);
                        
                        if (opcionesTipo.length > 0) {
                            window.productosOpciones[producto.nombre][tipoOpcion.nombre] = {
                                opciones: opcionesTipo.map(op => ({
                                    nombre: op.nombre,
                                    precio: parseFloat(op.precio) || 0
                                })),
                                configuracion: {
                                    titulo: tipoOpcion.titulo || tipoOpcion.nombre,
                                    tipo_seleccion: tipoOpcion.tipo_seleccion || 'radio',
                                    obligatorio: tipoOpcion.obligatorio === 'Si',
                                    multiple: tipoOpcion.tipo_seleccion === 'checkbox'
                                }
                            };
                        }
                    });
                }
            });
        }
        
        // Actualizar footer con informaci√≥n de contacto
        function actualizarFooterContacto(entidad, telefono) {
            const footerContacto = document.getElementById('footer-contacto');
            const redesSociales = document.getElementById('redes-sociales');
            
            if (entidad) {
                const nombre = entidad.nombre_completo || entidad.nombre || 'Contacto';
                const tel = telefono || entidad.telefono || '(504) 2234-5678';
                const email = entidad.email || 'info@deliverys.com';
                
                footerContacto.innerHTML = `üìû ${nombre}: ${tel} | üìß Email: ${email}`;
                
                // Actualizar redes sociales si existen
                redesSociales.innerHTML = '';
                
                const redes = [
                    { 
                        nombre: 'Facebook', 
                        icono: '<svg width="24" height="24" fill="#1877f2" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>', 
                        url: entidad.facebook_url 
                    },
                    { 
                        nombre: 'Instagram', 
                        icono: '<svg width="24" height="24" fill="url(#instagram-gradient)" viewBox="0 0 24 24"><defs><linearGradient id="instagram-gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#833ab4"/><stop offset="50%" style="stop-color:#fd1d1d"/><stop offset="100%" style="stop-color:#fcb045"/></linearGradient></defs><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>', 
                        url: entidad.instagram_url 
                    },
                    { 
                        nombre: 'Twitter', 
                        icono: '<svg width="24" height="24" fill="#1da1f2" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>', 
                        url: entidad.twitter_url 
                    },
                    { 
                        nombre: 'TikTok', 
                        icono: '<svg width="24" height="24" fill="#000000" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>', 
                        url: entidad.tiktok_url 
                    }
                ];
                
                redes.forEach(red => {
                    if (red.url) {
                        const enlace = document.createElement('a');
                        enlace.href = red.url;
                        enlace.target = '_blank';
                        enlace.style.cssText = 'color: white; text-decoration: none; font-size: 1.5rem; transition: transform 0.3s ease;';
                        enlace.innerHTML = red.icono;
                        enlace.title = red.nombre;
                        enlace.onmouseover = function() { this.style.transform = 'scale(1.2)'; };
                        enlace.onmouseout = function() { this.style.transform = 'scale(1)'; };
                        redesSociales.appendChild(enlace);
                    }
                });
                
                // Si no hay redes sociales, mostrar las de RMPOS por defecto
                if (redesSociales.children.length === 0 && datosAdmin) {
                    const redesDefault = [
                        { 
                            nombre: 'Facebook', 
                            icono: '<svg width="24" height="24" fill="#1877f2" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>', 
                            url: datosAdmin.facebook_url 
                        },
                        { 
                            nombre: 'Instagram', 
                            icono: '<svg width="24" height="24" fill="url(#instagram-gradient-default)" viewBox="0 0 24 24"><defs><linearGradient id="instagram-gradient-default" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#833ab4"/><stop offset="50%" style="stop-color:#fd1d1d"/><stop offset="100%" style="stop-color:#fcb045"/></linearGradient></defs><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>', 
                            url: datosAdmin.instagram_url 
                        },
                        { 
                            nombre: 'TikTok', 
                            icono: '<svg width="24" height="24" fill="#000000" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>', 
                            url: datosAdmin.tiktok_url 
                        }
                    ];
                    
                    redesDefault.forEach(red => {
                        if (red.url) {
                            const enlace = document.createElement('a');
                            enlace.href = red.url;
                            enlace.target = '_blank';
                            enlace.style.cssText = 'color: white; text-decoration: none; font-size: 1.5rem; transition: transform 0.3s ease; margin: 0 0.5rem;';
                            enlace.innerHTML = red.icono;
                            enlace.title = red.nombre;
                            enlace.onmouseover = function() { this.style.transform = 'scale(1.2)'; };
                            enlace.onmouseout = function() { this.style.transform = 'scale(1)'; };
                            redesSociales.appendChild(enlace);
                        }
                    });
                }
                
                // Si a√∫n no hay redes, mostrar mensaje por defecto
                if (redesSociales.children.length === 0) {
                    redesSociales.innerHTML = '<span style="color: #9ca3af;">S√≠guenos en nuestras redes sociales</span>';
                }
            }
        }
        
        // Funciones de autenticaci√≥n
        function mostrarLogin() {
            // Actualizar informaci√≥n del modal seg√∫n el contexto
            actualizarInfoModalLogin();
            document.getElementById('modal-login').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // Actualizar informaci√≥n del modal de login
        function actualizarInfoModalLogin() {
            let entidadInfo = datosAdmin; // Por defecto RMPOS
            
            // Determinar qu√© informaci√≥n mostrar seg√∫n el contexto
            if (negocioActual) {
                entidadInfo = negocioActual;
            } else if (deliveryActual) {
                entidadInfo = deliveryActual;
            }
            
            // Actualizar elementos del modal
            const nombreLogin = document.getElementById('nombre-login');
            const sloganLogin = document.getElementById('slogan-login');
            const emailLogin = document.getElementById('email-login');
            const telefonoLogin = document.getElementById('telefono-login');
            const imgLogoLogin = document.getElementById('img-logo-login');
            const placeholderLogoLogin = document.getElementById('placeholder-logo-login');
            
            nombreLogin.textContent = entidadInfo.nombre_completo || entidadInfo.nombre || 'RMPOS';
            sloganLogin.textContent = entidadInfo.slogan || entidadInfo.descripcion || 'Plataformas personalizadas a tu medida';
            emailLogin.textContent = `üìß ${entidadInfo.email || 'rmpos.hn@gmail.com'}`;
            telefonoLogin.textContent = `üìû ${entidadInfo.telefono || '+50493593126'}`;
            
            // Actualizar logo
            if (entidadInfo.logo_url) {
                imgLogoLogin.src = entidadInfo.logo_url;
                imgLogoLogin.classList.remove('hidden');
                placeholderLogoLogin.classList.add('hidden');
                
                imgLogoLogin.onerror = function() {
                    imgLogoLogin.classList.add('hidden');
                    placeholderLogoLogin.classList.remove('hidden');
                    placeholderLogoLogin.textContent = entidadInfo.nombre ? entidadInfo.nombre.charAt(0) : 'üè¢';
                };
            } else {
                imgLogoLogin.classList.add('hidden');
                placeholderLogoLogin.classList.remove('hidden');
                placeholderLogoLogin.textContent = entidadInfo.nombre ? entidadInfo.nombre.charAt(0) : 'üè¢';
            }
        }
        
        function cerrarLogin() {
            document.getElementById('modal-login').classList.add('hidden');
            document.body.style.overflow = 'auto';
            document.getElementById('input-usuario').value = '';
            document.getElementById('input-clave').value = '';
        }
        
        async function validarLogin() {
            const usuario = document.getElementById('input-usuario').value.trim();
            const clave = document.getElementById('input-clave').value.trim();
            
            if (!usuario || !clave) {
                mostrarNotificacionError('üîê Por favor completa todos los campos para iniciar sesi√≥n');
                return;
            }
            
            try {
                // Mostrar indicador de carga
                const btnLogin = document.querySelector('#modal-login button[onclick="validarLogin()"]');
                const textoOriginal = btnLogin.textContent;
                btnLogin.textContent = 'Validando...';
                btnLogin.disabled = true;
                
                // Datos para enviar al Google Apps Script
                const data = {
                    action: 'validateUser',
                    usuario: usuario,
                    clave: clave
                };
                
                // Llamar al Google Apps Script con el m√©todo correcto para evitar CORS
                const response = await fetch(AUTH_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8'
                    },
                    body: JSON.stringify(data),
                    redirect: 'follow'
                });
                
                if (!response.ok) {
                    throw new Error('Error en la validaci√≥n');
                }
                
                const result = await response.json();
                
                // Restaurar bot√≥n
                btnLogin.textContent = textoOriginal;
                btnLogin.disabled = false;
                
                if (result.success && result.user) {
                    const usuarioEncontrado = result.user;
                    
                    // Validar que el usuario tenga los campos requeridos y contexto correcto
                    if (usuarioEncontrado.estado === 'Activo' && usuarioEncontrado.tipo) {
                        // Validar contexto de acceso seg√∫n tipo de usuario
                        let accesoValido = false;
                        
                        if (usuarioEncontrado.tipo === 'Admin') {
                            // Admin solo puede loguearse desde enlace general
                            accesoValido = window.contextoURL.esEnlaceGeneral;
                        } else if (usuarioEncontrado.tipo === 'Delivery') {
                            // Delivery solo desde su enlace espec√≠fico
                            accesoValido = window.contextoURL.esEnlaceDelivery && 
                                          window.contextoURL.deliveryId == usuarioEncontrado.delivery_id;
                        } else if (usuarioEncontrado.tipo === 'Comercio') {
                            // Comercio solo desde su enlace espec√≠fico
                            accesoValido = window.contextoURL.esEnlaceNegocio && 
                                          window.contextoURL.negocioId == usuarioEncontrado.negocio_id;
                        }
                        
                        if (accesoValido) {
                            usuarioActual = usuarioEncontrado;
                            guardarSesion();
                            cerrarLogin();
                            
                            // Actualizar interfaz
                            actualizarInterfazUsuario();
                            
                            // Ocultar pantalla de acceso restringido si estaba visible
                            ocultarPantallaAccesoRestringido();
                            
                            // Renderizar seg√∫n tipo de usuario
                            renderizarPanelAdmin();
                            
                            mostrarNotificacion(`Bienvenido ${usuarioActual.nombre_completo || usuarioActual.usuario}`);
                        } else {
                            mostrarNotificacionError('‚ö†Ô∏è No tienes permisos para acceder desde este enlace. Usa el enlace correspondiente a tu tipo de cuenta.');
                        }
                    } else {
                        mostrarNotificacionError('‚ö†Ô∏è Tu cuenta est√° inactiva o requiere configuraci√≥n adicional. Contacta al administrador.');
                    }
                } else {
                    mostrarNotificacionError('‚ùå Credenciales incorrectas. Verifica tu usuario y contrase√±a e intenta nuevamente.');
                }
                
            } catch (error) {
                console.error('Error en validaci√≥n:', error);
                
                // Restaurar bot√≥n en caso de error
                const btnLogin = document.querySelector('#modal-login button[onclick="validarLogin()"]');
                if (btnLogin) {
                    btnLogin.textContent = 'Ingresar';
                    btnLogin.disabled = false;
                }
                
                mostrarNotificacionError('üåê Error de conexi√≥n. Verifica tu internet e intenta nuevamente.');
            }
        }
        
        function cerrarSesion() {
            usuarioActual = null;
            deliveryActual = null;
            negocioActual = null;
            vistaActual = 'negocios';
            categoriaActual = 'todas';
            
            limpiarSesion();
            actualizarInterfazUsuario();
            
            // Ocultar botones compartir
            ocultarBotonesCompartir();
            
            // Verificar si debe mostrar pantalla de acceso restringido
            const urlParams = new URLSearchParams(window.location.search);
            const deliveryId = urlParams.get('delivery');
            
            if (!deliveryId) {
                mostrarPantallaAccesoRestringido();
            } else {
                // Recargar contenido
                renderizarContenido();
            }
            
            mostrarNotificacion('Sesi√≥n cerrada');
        }
        
        // Funciones de compartir
        function compartirEnlace() {
            let url = window.location.origin + window.location.pathname;
            
            if (negocioActual && deliveryActual) {
                url += `?delivery=${deliveryActual.id}&negocio=${negocioActual.id}`;
            } else if (deliveryActual) {
                url += `?delivery=${deliveryActual.id}`;
            }
            
            if (navigator.share) {
                navigator.share({
                    title: negocioActual ? negocioActual.nombre : (deliveryActual ? deliveryActual.nombre : 'Sistema de Deliverys'),
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    mostrarNotificacion('Enlace copiado al portapapeles');
                });
            }
        }
        
        function compartirDelivery(deliveryId) {
            const url = `${window.location.origin}${window.location.pathname}?delivery=${deliveryId}`;
            
            if (navigator.share) {
                const delivery = deliverys.find(d => d.id == deliveryId);
                navigator.share({
                    title: delivery ? delivery.nombre : 'Delivery',
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    mostrarNotificacion('Enlace del delivery copiado');
                });
            }
        }
        
        function compartirNegocio(negocioId) {
            const negocio = negocios.find(n => n.id == negocioId);
            const url = `${window.location.origin}${window.location.pathname}?delivery=${negocio.delivery_id}&negocio=${negocioId}`;
            
            if (navigator.share) {
                navigator.share({
                    title: negocio ? negocio.nombre : 'Negocio',
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    mostrarNotificacion('Enlace del negocio copiado');
                });
            }
        }
        
        // Actualizar WhatsApp flotante
        function actualizarWhatsAppFlotante(telefono) {
            const whatsappBtn = document.getElementById('whatsapp-flotante');
            if (whatsappBtn && telefono) {
                const numeroLimpio = telefono.replace(/\D/g, '');
                const mensaje = encodeURIComponent('¬°Hola! Me gustar√≠a hacer un pedido');
                whatsappBtn.href = `https://wa.me/${numeroLimpio}?text=${mensaje}`;
            }
        }
        
        // Filtros
        function filtrarCategoriaNegocio(categoria) {
            categoriaActual = categoria;
            const botones = document.querySelectorAll('.category-btn');
            
            // Actualizar botones
            botones.forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Re-renderizar negocios
            const negociosDelivery = negocios.filter(n => n.delivery_id == deliveryActual.id);
            renderizarNegocios(negociosDelivery);
        }
        
        function filtrarCategoria(categoria) {
            categoriaActual = categoria;
            const botones = document.querySelectorAll('.category-btn');
            
            // Actualizar botones
            botones.forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Re-renderizar productos
            const productosNegocio = productos.filter(p => p.negocio_id == negocioActual.id);
            const categoriasNegocio = categorias.filter(c => 
                productosNegocio.some(p => p.categoria_id == c.id)
            );
            renderizarProductosPorCategorias(productosNegocio, categoriasNegocio);
        }
        
        // Funciones del carrusel
        function cambiarSlide(direccion) {
            slideActual += direccion;
            if (slideActual >= totalSlides) slideActual = 0;
            if (slideActual < 0) slideActual = totalSlides - 1;
            actualizarCarrusel();
        }

        function irASlide(indice) {
            slideActual = indice;
            actualizarCarrusel();
        }

        function actualizarCarrusel() {
            const carrusel = document.getElementById('carrusel-promociones');
            const desplazamiento = -slideActual * 100;
            carrusel.style.transform = `translateX(${desplazamiento}%)`;
            
            // Actualizar indicadores
            for (let i = 0; i < totalSlides; i++) {
                const indicador = document.getElementById(`indicador-${i}`);
                if (indicador) {
                    if (i === slideActual) {
                        indicador.style.background = 'white';
                    } else {
                        indicador.style.background = 'rgba(255,255,255,0.5)';
                    }
                }
            }
        }

        // Auto-avanzar el carrusel cada 5 segundos
        setInterval(() => {
            if (totalSlides > 0) {
                cambiarSlide(1);
            }
        }, 5000);

        // Funciones del carrito y productos (mantener las existentes pero simplificadas)
        function ordenarProducto(nombre, precio, quantityId) {
            const cantidad = parseInt(document.getElementById(quantityId).value);
            
            // Siempre verificar si el producto tiene opciones, independientemente del login
            if (window.productosOpciones && window.productosOpciones[nombre]) {
                abrirModalOpciones(nombre, precio, cantidad, quantityId);
            } else {
                // Agregar directamente si no tiene opciones
                agregarAlCarritoDirecto(nombre, precio, cantidad, quantityId);
            }
        }

        function abrirModalOpcionesConSelecciones(nombre, precioBase, cantidad, quantityId, opcionesSeleccionadas = null) {
            const opciones = window.productosOpciones[nombre];
            if (!opciones) {
                agregarAlCarritoDirecto(nombre, precioBase, cantidad, quantityId);
                return;
            }
            
            // Crear modal de opciones
            const modal = document.createElement('div');
            modal.id = 'modal-opciones';
            modal.className = 'modal';
            
            let opcionesHTML = '';
            let tiposOpciones = Object.keys(opciones);
            
            tiposOpciones.forEach(tipoOpcion => {
                const config = opciones[tipoOpcion].configuracion;
                const opcionesTipo = opciones[tipoOpcion].opciones;
                
                opcionesHTML += `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="font-weight: 600; margin-bottom: 0.75rem; color: #374151;">
                            ${config.titulo} ${config.obligatorio ? '*' : ''}
                        </h4>
                        <div style="display: grid; gap: 0.5rem;">
                `;
                
                opcionesTipo.forEach((opcion, index) => {
                    const inputType = config.multiple ? 'checkbox' : 'radio';
                    const inputName = config.multiple ? `opcion-${tipoOpcion}` : `opcion-${tipoOpcion}`;
                    const inputId = `${inputName}-${index}`;
                    
                    // Verificar si esta opci√≥n estaba seleccionada previamente
                    let defaultChecked = '';
                    if (opcionesSeleccionadas && opcionesSeleccionadas.length > 0) {
                        // Buscar tanto por nombre simple como por nombre con precio
                        const opcionTextoConPrecio = opcion.precio > 0 ? `${opcion.nombre} (+LPS. ${opcion.precio.toFixed(2)})` : opcion.nombre;
                        const opcionTextoSimple = opcion.nombre;
                        
                        // Tambi√©n buscar por coincidencia parcial para mayor flexibilidad
                        const coincidencia = opcionesSeleccionadas.some(opcionGuardada => 
                            opcionGuardada === opcionTextoConPrecio || 
                            opcionGuardada === opcionTextoSimple ||
                            opcionGuardada.includes(opcion.nombre)
                        );
                        
                        defaultChecked = coincidencia ? 'checked' : '';
                    } else if (!config.multiple && config.obligatorio && index === 0) {
                        defaultChecked = 'checked';
                    }
                    
                    opcionesHTML += `
                        <label style="display: flex; align-items: center; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; cursor: pointer; transition: all 0.3s ease;" 
                               onmouseover="this.style.backgroundColor='#f3f4f6'" 
                               onmouseout="this.style.backgroundColor='white'">
                            <input type="${inputType}" name="${inputName}" value="${opcion.nombre}" 
                                   data-precio="${opcion.precio}" id="${inputId}" ${defaultChecked}
                                   style="margin-right: 0.75rem;" 
                                   onchange="actualizarPrecioModal('${nombre}', ${precioBase})">
                            <div style="flex: 1;">
                                <span style="font-weight: 500;">${opcion.nombre}</span>
                                ${opcion.precio > 0 ? `<span style="color: #16a34a; font-weight: 600; margin-left: 0.5rem;">+LPS. ${opcion.precio.toFixed(2)}</span>` : ''}
                            </div>
                        </label>
                    `;
                });
                
                opcionesHTML += `
                        </div>
                    </div>
                `;
            });
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 28rem; display: flex; flex-direction: column; max-height: 90vh;">
                    <div class="modal-header">
                        <h3 class="text-lg font-bold">üçΩÔ∏è Personalizar: ${nombre}</h3>
                        <button onclick="cerrarModalOpcionesConCancelacion()" class="text-white hover:text-gray-200 text-2xl font-bold">&times;</button>
                    </div>
                    
                    <!-- Informaci√≥n fija superior -->
                    <div style="padding: 1rem; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                        <div class="flex justify-between items-center mb-2">
                            <span style="font-weight: 600; color: #374151;">Precio base:</span>
                            <span style="font-weight: 600; color: #dc2626;">LPS. ${precioBase.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span style="font-weight: 600;">Cantidad:</span>
                            <div class="flex items-center space-x-2">
                                <button onclick="cambiarCantidadModal(-1)" style="background: #d1d5db; color: #374151; width: 2rem; height: 2rem; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer;">-</button>
                                <span id="cantidad-modal" style="font-weight: 600; min-width: 2rem; text-align: center;">${cantidad}</span>
                                <button onclick="cambiarCantidadModal(1)" style="background: #d1d5db; color: #374151; width: 2rem; height: 2rem; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer;">+</button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span style="font-weight: 600; font-size: 1.125rem;">Total:</span>
                            <span id="precio-total-modal" style="font-weight: 700; font-size: 1.25rem; color: #dc2626;">LPS. ${(precioBase * cantidad).toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <!-- Opciones scrollables -->
                    <div style="padding: 1.5rem; flex: 1; overflow-y: auto;">
                        ${opcionesHTML}
                    </div>
                    
                    <!-- Bot√≥n fijo inferior -->
                    <div style="padding: 1rem; border-top: 1px solid #e5e7eb; background: white;">
                        <button onclick="confirmarOpcionesYAgregar('${nombre}', ${precioBase}, '${quantityId}')" 
                                style="width: 100%; background: #16a34a; color: white; padding: 0.75rem; border-radius: 0.5rem; border: none; font-weight: 600; cursor: pointer; transition: background 0.3s ease;"
                                onmouseover="this.style.backgroundColor='#15803d'"
                                onmouseout="this.style.backgroundColor='#16a34a'">
                            Agregar al Carrito
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Calcular precio inicial con opciones seleccionadas
            setTimeout(() => {
                actualizarPrecioModal(nombre, precioBase);
            }, 100);
        }

        function abrirModalOpciones(nombre, precioBase, cantidad, quantityId) {
            const opciones = window.productosOpciones[nombre];
            if (!opciones) {
                agregarAlCarritoDirecto(nombre, precioBase, cantidad, quantityId);
                return;
            }
            
            // Crear modal de opciones
            const modal = document.createElement('div');
            modal.id = 'modal-opciones';
            modal.className = 'modal';
            
            let opcionesHTML = '';
            let tiposOpciones = Object.keys(opciones);
            
            tiposOpciones.forEach(tipoOpcion => {
                const config = opciones[tipoOpcion].configuracion;
                const opcionesTipo = opciones[tipoOpcion].opciones;
                
                opcionesHTML += `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="font-weight: 600; margin-bottom: 0.75rem; color: #374151;">
                            ${config.titulo} ${config.obligatorio ? '*' : ''}
                        </h4>
                        <div style="display: grid; gap: 0.5rem;">
                `;
                
                opcionesTipo.forEach((opcion, index) => {
                    const inputType = config.multiple ? 'checkbox' : 'radio';
                    const inputName = config.multiple ? `opcion-${tipoOpcion}` : `opcion-${tipoOpcion}`;
                    const inputId = `${inputName}-${index}`;
                    
                    // Seleccionar por defecto la primera opci√≥n si es obligatoria y no es m√∫ltiple
                    const defaultChecked = (!config.multiple && config.obligatorio && index === 0) ? 'checked' : '';
                    
                    opcionesHTML += `
                        <label style="display: flex; align-items: center; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; cursor: pointer; transition: all 0.3s ease;" 
                               onmouseover="this.style.backgroundColor='#f3f4f6'" 
                               onmouseout="this.style.backgroundColor='white'">
                            <input type="${inputType}" name="${inputName}" value="${opcion.nombre}" 
                                   data-precio="${opcion.precio}" id="${inputId}" ${defaultChecked}
                                   style="margin-right: 0.75rem;" 
                                   onchange="actualizarPrecioModal('${nombre}', ${precioBase})">
                            <div style="flex: 1;">
                                <span style="font-weight: 500;">${opcion.nombre}</span>
                                ${opcion.precio > 0 ? `<span style="color: #16a34a; font-weight: 600; margin-left: 0.5rem;">+LPS. ${opcion.precio.toFixed(2)}</span>` : ''}
                            </div>
                        </label>
                    `;
                });
                
                opcionesHTML += `
                        </div>
                    </div>
                `;
            });
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 28rem; display: flex; flex-direction: column; max-height: 90vh;">
                    <div class="modal-header">
                        <h3 class="text-lg font-bold">üçΩÔ∏è Personalizar: ${nombre}</h3>
                        <button onclick="cerrarModalOpciones()" class="text-white hover:text-gray-200 text-2xl font-bold">&times;</button>
                    </div>
                    
                    <!-- Informaci√≥n fija superior -->
                    <div style="padding: 1rem; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                        <div class="flex justify-between items-center mb-2">
                            <span style="font-weight: 600; color: #374151;">Precio base:</span>
                            <span style="font-weight: 600; color: #dc2626;">LPS. ${precioBase.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span style="font-weight: 600;">Cantidad:</span>
                            <div class="flex items-center space-x-2">
                                <button onclick="cambiarCantidadModal(-1)" style="background: #d1d5db; color: #374151; width: 2rem; height: 2rem; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer;">-</button>
                                <span id="cantidad-modal" style="font-weight: 600; min-width: 2rem; text-align: center;">${cantidad}</span>
                                <button onclick="cambiarCantidadModal(1)" style="background: #d1d5db; color: #374151; width: 2rem; height: 2rem; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer;">+</button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span style="font-weight: 600; font-size: 1.125rem;">Total:</span>
                            <span id="precio-total-modal" style="font-weight: 700; font-size: 1.25rem; color: #dc2626;">LPS. ${(precioBase * cantidad).toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <!-- Opciones scrollables -->
                    <div style="padding: 1.5rem; flex: 1; overflow-y: auto;">
                        ${opcionesHTML}
                    </div>
                    
                    <!-- Bot√≥n fijo inferior -->
                    <div style="padding: 1rem; border-top: 1px solid #e5e7eb; background: white;">
                        <button onclick="confirmarOpcionesYAgregar('${nombre}', ${precioBase}, '${quantityId}')" 
                                style="width: 100%; background: #16a34a; color: white; padding: 0.75rem; border-radius: 0.5rem; border: none; font-weight: 600; cursor: pointer; transition: background 0.3s ease;"
                                onmouseover="this.style.backgroundColor='#15803d'"
                                onmouseout="this.style.backgroundColor='#16a34a'">
                            Agregar al Carrito
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Calcular precio inicial con opciones por defecto seleccionadas
            setTimeout(() => {
                actualizarPrecioModal(nombre, precioBase);
            }, 100);
        }
        
        function validarOpcionesObligatorias(nombre) {
            const opciones = window.productosOpciones[nombre];
            if (!opciones) return true;
            
            for (const tipoOpcion in opciones) {
                const config = opciones[tipoOpcion].configuracion;
                if (config.obligatorio) {
                    const opcionesSeleccionadas = document.querySelectorAll(`#modal-opciones input[name="opcion-${tipoOpcion}"]:checked`);
                    if (opcionesSeleccionadas.length === 0) {
                        mostrarNotificacionError(`‚ö†Ô∏è Debes seleccionar una opci√≥n para: ${config.titulo}`);
                        return false;
                    }
                }
            }
            return true;
        }
        
        function cerrarModalOpciones() {
            const modal = document.getElementById('modal-opciones');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
            }
        }
        
        function cerrarModalOpcionesConCancelacion() {
            // Si hay un item siendo editado, restaurarlo al carrito
            if (window.itemEditando) {
                carrito.push(window.itemEditando);
                actualizarCarrito();
                window.itemEditando = null;
            }
            
            cerrarModalOpciones();
        }
        
        function actualizarPrecioModal(nombre, precioBase) {
            const cantidadActual = parseInt(document.getElementById('cantidad-modal').textContent);
            let precioTotal = precioBase * cantidadActual;
            
            // Sumar precios de opciones seleccionadas
            const opcionesSeleccionadas = document.querySelectorAll('#modal-opciones input:checked');
            opcionesSeleccionadas.forEach(opcion => {
                const precioOpcion = parseFloat(opcion.dataset.precio) || 0;
                precioTotal += precioOpcion * cantidadActual;
            });
            
            document.getElementById('precio-total-modal').textContent = `LPS. ${precioTotal.toFixed(2)}`;
        }
        
        function cambiarCantidadModal(cambio) {
            const cantidadElement = document.getElementById('cantidad-modal');
            let cantidad = parseInt(cantidadElement.textContent) + cambio;
            if (cantidad < 1) cantidad = 1;
            cantidadElement.textContent = cantidad;
            
            // Actualizar precio - obtener precio base del producto original
            const modal = document.getElementById('modal-opciones');
            const titulo = modal.querySelector('.modal-header h3').textContent;
            const nombre = titulo.split('Personalizar: ')[1];
            
            // Buscar el precio base original del producto
            const producto = productos.find(p => p.nombre === nombre);
            const precioBase = producto ? parseFloat(producto.precio_base) : 0;
            
            actualizarPrecioModal(nombre, precioBase);
        }
        
        function confirmarOpcionesYAgregar(nombre, precioBase, quantityId) {
            // Validar opciones obligatorias
            if (!validarOpcionesObligatorias(nombre)) {
                return;
            }
            
            const cantidadModal = parseInt(document.getElementById('cantidad-modal').textContent);
            let nombreCompleto = nombre;
            let precioFinal = precioBase;
            
            // Recopilar opciones seleccionadas
            const opcionesSeleccionadas = document.querySelectorAll('#modal-opciones input:checked');
            const opcionesTexto = [];
            const opcionesParaComparar = [];
            
            opcionesSeleccionadas.forEach(opcion => {
                const precioOpcion = parseFloat(opcion.dataset.precio) || 0;
                precioFinal += precioOpcion;
                
                if (precioOpcion > 0) {
                    opcionesTexto.push(`${opcion.value} (+LPS. ${precioOpcion.toFixed(2)})`);
                } else {
                    opcionesTexto.push(opcion.value);
                }
                opcionesParaComparar.push(opcion.value);
            });
            
            if (opcionesTexto.length > 0) {
                nombreCompleto += ` (${opcionesTexto.join(', ')})`;
            }
            
            // Buscar si ya existe un producto con las mismas opciones
            const productoExistente = carrito.find(item => 
                item.nombreBase === nombre && 
                item.opciones && 
                JSON.stringify(item.opciones.sort()) === JSON.stringify(opcionesTexto.sort())
            );
            
            if (productoExistente) {
                // Sumar cantidad al producto existente
                productoExistente.cantidad += cantidadModal;
                productoExistente.subtotal = productoExistente.precio * productoExistente.cantidad;
            } else {
                // Agregar nuevo producto al carrito
                carrito.push({
                    id: Date.now() + Math.random(),
                    nombre: nombreCompleto,
                    nombreBase: nombre,
                    precio: precioFinal,
                    cantidad: cantidadModal,
                    subtotal: precioFinal * cantidadModal,
                    imagen: obtenerImagenProducto(nombre),
                    opciones: opcionesTexto,
                    editable: true
                });
            }
            
            actualizarCarrito();
            guardarCarrito();
            cerrarModalOpciones();
            mostrarNotificacion(`${nombre} agregado al carrito`);
            
            // Limpiar item editando
            window.itemEditando = null;
            
            // Resetear cantidad original
            document.getElementById(quantityId).value = 1;
        }

        function agregarAlCarritoDirecto(nombre, precio, cantidad, quantityId) {
            const subtotal = precio * cantidad;
            
            // Buscar si el producto ya existe en el carrito (sin opciones)
            const productoExistente = carrito.find(item => item.nombre === nombre && !item.opciones);
            
            if (productoExistente) {
                productoExistente.cantidad += cantidad;
                productoExistente.subtotal = productoExistente.precio * productoExistente.cantidad;
            } else {
                carrito.push({
                    id: Date.now() + Math.random(),
                    nombre: nombre,
                    precio: precio,
                    cantidad: cantidad,
                    subtotal: subtotal,
                    imagen: obtenerImagenProducto(nombre)
                });
            }
            
            actualizarCarrito();
            guardarCarrito();
            mostrarNotificacion(`${nombre} agregado al carrito`);
            
            // Resetear cantidad a 1
            document.getElementById(quantityId).value = 1;
        }

        function actualizarCarrito() {
            const carritoFlotante = document.getElementById('carrito-flotante');
            const contadorCarrito = document.getElementById('contador-carrito');
            const itemsCarritoModal = document.getElementById('items-carrito-modal');
            const totalCarritoModal = document.getElementById('total-carrito-modal');
            const carritoVacio = document.getElementById('carrito-vacio');
            const footerCarrito = document.getElementById('footer-carrito');
            
            // Calcular total de items
            const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
            
            if (carrito.length === 0) {
                carritoFlotante.classList.add('hidden');
                carritoVacio.classList.remove('hidden');
                footerCarrito.classList.add('hidden');
                return;
            }
            
            // Mostrar bot√≥n flotante
            carritoFlotante.classList.remove('hidden');
            contadorCarrito.textContent = totalItems;
            
            // Actualizar modal
            carritoVacio.classList.add('hidden');
            footerCarrito.classList.remove('hidden');
            itemsCarritoModal.innerHTML = '';
            total = 0;
            
            carrito.forEach((item) => {
                total += item.subtotal;
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'background: #f9fafb; border-radius: 0.5rem; padding: 0.75rem;';
                itemDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div style="width: 3rem; height: 3rem; border-radius: 0.5rem; overflow: hidden; flex-shrink: 0;">
                            ${item.imagen}
                        </div>
                        <div style="flex: 1;">
                            <div class="flex justify-between items-start mb-2">
                                <h4 style="font-weight: 500; font-size: 0.875rem;">${item.nombre}</h4>
                                <div style="display: flex; gap: 0.5rem; align-items: center; flex-shrink: 0;">
                                    ${item.editable ? `<button onclick="editarProductoCarrito('${item.id}')" style="color: #3b82f6; background: #eff6ff; border: 1px solid #dbeafe; border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; min-width: 60px; justify-content: center;" title="Editar opciones">‚úèÔ∏è</button>` : ''}
                                    <button onclick="eliminarDelCarrito('${item.id}')" style="color: #dc2626; background: #fef2f2; border: 1px solid #fecaca; border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; min-width: 60px; justify-content: center;" title="Eliminar producto">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-2">
                                    <button onclick="cambiarCantidad('${item.id}', -1)" style="background: #d1d5db; color: #374151; width: 1.5rem; height: 1.5rem; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; cursor: pointer;">-</button>
                                    <span style="font-size: 0.875rem; font-weight: 500;">${item.cantidad}</span>
                                    <button onclick="cambiarCantidad('${item.id}', 1)" style="background: #d1d5db; color: #374151; width: 1.5rem; height: 1.5rem; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; cursor: pointer;">+</button>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 0.75rem; color: #6b7280;">LPS. ${item.precio.toFixed(2)} c/u</div>
                                    <div style="font-weight: 600;">LPS. ${item.subtotal.toFixed(2)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                itemsCarritoModal.appendChild(itemDiv);
            });
            
            totalCarritoModal.textContent = `LPS. ${total.toFixed(2)}`;
        }

        function cambiarCantidad(itemId, cambio) {
            const item = carrito.find(producto => producto.id == itemId);
            if (item) {
                item.cantidad += cambio;
                if (item.cantidad <= 0) {
                    eliminarDelCarrito(itemId);
                    return;
                }
                item.subtotal = item.precio * item.cantidad;
                actualizarCarrito();
                guardarCarrito(); // Persistir cambios
            }
        }

        function editarProductoCarrito(itemId) {
            const item = carrito.find(producto => producto.id == itemId);
            if (!item || !item.editable) return;
            
            // Guardar el item para restaurarlo si se cancela
            window.itemEditando = JSON.parse(JSON.stringify(item));
            
            // Eliminar el item actual del carrito
            carrito = carrito.filter(producto => producto.id != itemId);
            actualizarCarrito();
            
            // Abrir modal de opciones con los datos del producto
            const nombreBase = item.nombreBase || item.nombre.split(' (')[0];
            const precioBase = productos.find(p => p.nombre === nombreBase)?.precio_base || item.precio;
            
            abrirModalOpcionesConSelecciones(nombreBase, parseFloat(precioBase), item.cantidad, 'edit-' + itemId, item.opciones);
        }

        function eliminarDelCarrito(itemId) {
            carrito = carrito.filter(item => item.id != itemId);
            actualizarCarrito();
            guardarCarrito(); // Persistir cambios
            
            // Si el carrito queda vac√≠o, cerrar el modal
            if (carrito.length === 0) {
                setTimeout(() => {
                    cerrarModal();
                }, 500);
            }
        }

        function vaciarCarrito() {
            carrito = [];
            actualizarCarrito();
            cerrarModal();
            mostrarNotificacion('Carrito vaciado');
        }

        function abrirModal() {
            document.getElementById('modal-carrito').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function cerrarModal() {
            document.getElementById('modal-carrito').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function obtenerImagenProducto(nombre) {
            // Extraer el nombre base del producto (sin opciones)
            const nombreBase = nombre.split(' (')[0];
            
            // Buscar el producto en los datos cargados
            const producto = productos.find(p => p.nombre === nombreBase);
            
            if (producto && producto.imagen_url) {
                return `<img src="${producto.imagen_url}" alt="${producto.nombre}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem;">`;
            }
            
            // Buscar la categor√≠a del producto para usar su icono
            if (producto) {
                const categoria = categorias.find(c => c.id == producto.categoria_id);
                const icono = categoria ? categoria.icono : 'üçΩÔ∏è';
                return `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #e5e7eb, #9ca3af); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">${icono}</div>`;
            }
            
            // Fallback por defecto
            return '<div style="width: 100%; height: 100%; background: #e5e7eb; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üçΩÔ∏è</div>';
        }

        function actualizarCamposFormulario() {
            const tipoPedido = document.getElementById('tipo-pedido').value;
            const campoTelefono = document.getElementById('campo-telefono');
            const campoDireccion = document.getElementById('campo-direccion');
            const campoMesa = document.getElementById('campo-mesa');
            
            // Resetear campos
            campoTelefono.classList.remove('hidden');
            campoDireccion.classList.add('hidden');
            campoMesa.classList.add('hidden');
            
            if (tipoPedido === 'domicilio') {
                campoDireccion.classList.remove('hidden');
            } else if (tipoPedido === 'llevar') {
                // Solo tel√©fono visible
            } else if (tipoPedido === 'restaurante') {
                campoTelefono.classList.add('hidden');
                campoMesa.classList.remove('hidden');
            }
        }

        function validarFormulario() {
            const tipoPedido = document.getElementById('tipo-pedido').value;
            const nombre = document.getElementById('nombre-cliente').value.trim();
            const telefono = document.getElementById('telefono-cliente').value.trim();
            const direccion = document.getElementById('direccion-cliente').value.trim();
            
            // Nombre siempre es obligatorio
            if (!nombre) {
                mostrarNotificacionError('üë§ Por favor ingresa tu nombre completo para continuar');
                return false;
            }
            
            // Validaciones seg√∫n tipo de pedido
            if (tipoPedido === 'domicilio') {
                if (!telefono) {
                    mostrarNotificacionError('üìû Necesitamos tu tel√©fono para coordinar la entrega a domicilio');
                    return false;
                }
                if (!direccion) {
                    mostrarNotificacionError('üìç Por favor proporciona tu direcci√≥n completa para el env√≠o');
                    return false;
                }
            } else if (tipoPedido === 'llevar') {
                if (!telefono) {
                    mostrarNotificacionError('üìû Ingresa tu tel√©fono para notificarte cuando tu pedido est√© listo');
                    return false;
                }
            }
            
            return true;
        }

        function enviarPorWhatsApp() {
            if (carrito.length === 0) {
                mostrarNotificacionError('üõí Tu carrito est√° vac√≠o. Agrega algunos productos antes de realizar el pedido');
                return;
            }
            
            if (!validarFormulario()) {
                return;
            }
            
            const tipoPedido = document.getElementById('tipo-pedido').value;
            const nombre = document.getElementById('nombre-cliente').value.trim();
            const telefono = document.getElementById('telefono-cliente').value.trim();
            const direccion = document.getElementById('direccion-cliente').value.trim();
            const mesa = document.getElementById('mesa-cliente').value.trim();
            const notificarComercio = document.getElementById('notificar-comercio').checked;
            
            // Generar n√∫mero de gesti√≥n √∫nico
            const ahora = new Date();
            const numeroGestion = ahora.getFullYear().toString() + 
                                (ahora.getMonth() + 1).toString().padStart(2, '0') + 
                                ahora.getDate().toString().padStart(2, '0') + 
                                ahora.getHours().toString().padStart(2, '0') + 
                                ahora.getMinutes().toString().padStart(2, '0') + 
                                ahora.getSeconds().toString().padStart(2, '0');
            
            // Crear mensaje base
            let mensaje = `üçï *NUEVO PEDIDO* üçï\n`;
            mensaje += `üìã *N¬∫ Gesti√≥n:* ${numeroGestion}\n\n`;
            
            // Informaci√≥n del delivery y negocio
            if (deliveryActual) {
                mensaje += `üöö *Delivery:* ${deliveryActual.nombre}\n`;
            }
            if (negocioActual) {
                mensaje += `üè™ *Negocio:* ${negocioActual.nombre}\n`;
            }
            mensaje += '\n';
            
            // Informaci√≥n del cliente
            mensaje += '*DATOS DEL CLIENTE:*\n';
            mensaje += `üë§ Nombre: ${nombre}\n`;
            
            if (tipoPedido === 'domicilio') {
                mensaje += `üöö Tipo: Env√≠o a domicilio\n`;
                mensaje += `üìû Tel√©fono: ${telefono}\n`;
                mensaje += `üìç Direcci√≥n: ${direccion}\n`;
                if (ubicacionCliente) {
                    mensaje += `üó∫Ô∏è Ubicaci√≥n GPS: https://maps.google.com/?q=${ubicacionCliente.lat},${ubicacionCliente.lng}\n`;
                }
            } else if (tipoPedido === 'llevar') {
                mensaje += `ü•° Tipo: Para llevar\n`;
                mensaje += `üìû Tel√©fono: ${telefono}\n`;
            } else if (tipoPedido === 'restaurante') {
                mensaje += `üçΩÔ∏è Tipo: Comer en restaurante\n`;
                if (mesa) {
                    mensaje += `ü™ë Mesa: ${mesa}\n`;
                }
            }
            
            mensaje += '\n*PRODUCTOS:*\n';
            
            carrito.forEach(item => {
                mensaje += `‚Ä¢ ${item.nombre}\n`;
                mensaje += `  Cantidad: ${item.cantidad}\n`;
                mensaje += `  Precio unitario: LPS. ${item.precio.toFixed(2)}\n`;
                mensaje += `  Subtotal: LPS. ${item.subtotal.toFixed(2)}\n\n`;
            });
            
            mensaje += `*TOTAL: LPS. ${total.toFixed(2)}*\n\n`;
            mensaje += '¬°Gracias por tu pedido! üòä';
            
            // Enviar al Delivery (principal)
            if (deliveryActual && deliveryActual.telefono) {
                const numeroDelivery = deliveryActual.telefono.replace(/\D/g, '');
                const urlDelivery = `https://wa.me/${numeroDelivery}?text=${encodeURIComponent(mensaje)}`;
                window.open(urlDelivery, '_blank');
                
                // Enviar al Comercio si est√° marcado
                if (notificarComercio && negocioActual && negocioActual.telefono) {
                    const mensajeComercio = mensaje.replace('üçï *NUEVO PEDIDO* üçï', 'üçï *PEDIDO PARA TU NEGOCIO* üçï');
                    const numeroComercio = negocioActual.telefono.replace(/\D/g, '');
                    
                    // Solo enviar si el n√∫mero es diferente al delivery
                    if (numeroComercio !== numeroDelivery) {
                        const urlComercio = `https://wa.me/${numeroComercio}?text=${encodeURIComponent(mensajeComercio)}`;
                        
                        // Mostrar confirmaci√≥n para abrir el segundo enlace
                        setTimeout(() => {
                            if (confirm('¬øTambi√©n deseas notificar directamente al comercio por WhatsApp?')) {
                                window.open(urlComercio, '_blank');
                            }
                        }, 2000);
                    }
                }
                
                // Limpiar carrito y cerrar modal despu√©s del env√≠o
                setTimeout(() => {
                    carrito = [];
                    total = 0;
                    limpiarCarrito(); // Limpiar persistencia
                    actualizarCarrito();
                    cerrarModal();
                    mostrarNotificacion('¬°Pedido enviado exitosamente!');
                }, 2000);
            } else {
                mostrarNotificacionError('üìû No se pudo enviar el pedido. El n√∫mero de tel√©fono del delivery no est√° disponible. Contacta al administrador.');
            }
        }
        
        // Funci√≥n para toggle del men√∫ m√≥vil
        function toggleMenuMobile() {
            const mobileNavbar = document.getElementById('mobile-navbar');
            mobileNavbar.classList.toggle('hidden');
        }
        
        // Funciones de persistencia de sesi√≥n y carrito
        function guardarSesion() {
            if (usuarioActual) {
                localStorage.setItem('usuarioActual', JSON.stringify(usuarioActual));
            }
        }
        
        function guardarCarrito() {
            localStorage.setItem('carrito', JSON.stringify(carrito));
            localStorage.setItem('totalCarrito', total.toString());
        }
        
        function restaurarCarrito() {
            const carritoGuardado = localStorage.getItem('carrito');
            const totalGuardado = localStorage.getItem('totalCarrito');
            
            if (carritoGuardado) {
                try {
                    carrito = JSON.parse(carritoGuardado);
                    total = parseFloat(totalGuardado) || 0;
                    actualizarCarrito();
                } catch (error) {
                    console.error('Error al restaurar carrito:', error);
                    carrito = [];
                    total = 0;
                }
            }
        }
        
        function limpiarCarrito() {
            localStorage.removeItem('carrito');
            localStorage.removeItem('totalCarrito');
        }
        
        // Funci√≥n para obtener ubicaci√≥n GPS
        function obtenerUbicacion() {
            const estadoUbicacion = document.getElementById('estado-ubicacion');
            
            if (!navigator.geolocation) {
                estadoUbicacion.textContent = '‚ùå Tu navegador no soporta geolocalizaci√≥n';
                estadoUbicacion.style.color = '#dc2626';
                return;
            }
            
            estadoUbicacion.textContent = 'üìç Obteniendo ubicaci√≥n...';
            estadoUbicacion.style.color = '#3b82f6';
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    ubicacionCliente = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    estadoUbicacion.textContent = '‚úÖ Ubicaci√≥n obtenida correctamente';
                    estadoUbicacion.style.color = '#16a34a';
                    
                    // Opcional: Intentar obtener direcci√≥n aproximada usando reverse geocoding
                    // (Esto requerir√≠a una API key de Google Maps, por ahora solo guardamos coordenadas)
                },
                function(error) {
                    let mensaje = '‚ùå ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            mensaje += 'Permiso denegado para acceder a la ubicaci√≥n';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            mensaje += 'Ubicaci√≥n no disponible';
                            break;
                        case error.TIMEOUT:
                            mensaje += 'Tiempo de espera agotado';
                            break;
                        default:
                            mensaje += 'Error desconocido al obtener ubicaci√≥n';
                            break;
                    }
                    estadoUbicacion.textContent = mensaje;
                    estadoUbicacion.style.color = '#dc2626';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }
        
        function restaurarSesion() {
            const sesionGuardada = localStorage.getItem('usuarioActual');
            if (sesionGuardada) {
                try {
                    usuarioActual = JSON.parse(sesionGuardada);
                    actualizarInterfazUsuario();
                } catch (error) {
                    console.error('Error al restaurar sesi√≥n:', error);
                    localStorage.removeItem('usuarioActual');
                }
            }
        }
        
        function limpiarSesion() {
            localStorage.removeItem('usuarioActual');
        }
        
        function actualizarInterfazUsuario() {
            if (usuarioActual) {
                // Desktop
                document.getElementById('btn-login-desktop').classList.add('hidden');
                document.getElementById('btn-logout-desktop').classList.remove('hidden');
                document.getElementById('usuario-logueado-desktop').classList.remove('hidden');
                document.getElementById('usuario-logueado-desktop').textContent = `üë§ ${usuarioActual.nombre_completo || usuarioActual.usuario}`;
                
                // Mobile
                document.getElementById('btn-login-mobile').classList.add('hidden');
                document.getElementById('btn-logout-mobile').classList.remove('hidden');
                document.getElementById('usuario-logueado-mobile').classList.remove('hidden');
                document.getElementById('usuario-logueado-mobile').textContent = usuarioActual.nombre_completo || usuarioActual.usuario;
            } else {
                // Desktop
                document.getElementById('btn-login-desktop').classList.remove('hidden');
                document.getElementById('btn-logout-desktop').classList.add('hidden');
                document.getElementById('usuario-logueado-desktop').classList.add('hidden');
                
                // Mobile
                document.getElementById('btn-login-mobile').classList.remove('hidden');
                document.getElementById('btn-logout-mobile').classList.add('hidden');
                document.getElementById('usuario-logueado-mobile').classList.add('hidden');
            }
        }
        
        // Funciones de utilidad
        function mostrarCargando(mostrar) {
            let loader = document.getElementById('loader-principal');
            if (!loader && mostrar) {
                loader = document.createElement('div');
                loader.id = 'loader-principal';
                loader.style.cssText = 'position: fixed; inset: 0; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000;';
                loader.innerHTML = `
                    <div style="text-center">
                        <div class="loading-spinner"></div>
                        <p style="color: #6b7280; font-size: 1.125rem; margin-top: 1rem;">Cargando datos...</p>
                    </div>
                `;
                document.body.appendChild(loader);
            } else if (loader && !mostrar) {
                loader.remove();
            }
        }
        
        function mostrarError(mensaje) {
            const error = document.createElement('div');
            error.className = 'notification error';
            error.textContent = mensaje;
            document.body.appendChild(error);
            setTimeout(() => error.remove(), 5000);
        }
        
        function mostrarNotificacion(mensaje) {
            const notificacion = document.createElement('div');
            notificacion.className = 'notification success';
            notificacion.textContent = mensaje;
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notificacion)) {
                        document.body.removeChild(notificacion);
                    }
                }, 300);
            }, 3000);
        }
        
        function mostrarNotificacionError(mensaje) {
            const notificacion = document.createElement('div');
            notificacion.className = 'notification error';
            notificacion.textContent = mensaje;
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notificacion)) {
                        document.body.removeChild(notificacion);
                    }
                }, 300);
            }, 4000);
        }
        
        function mostrarMensajeSinDatos() {
            document.getElementById('contenido-principal').innerHTML = `
                <div class="text-center" style="padding: 3rem 0;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üöö</div>
                    <h2 class="text-2xl font-bold mb-4" style="color: #374151;">No hay deliverys disponibles</h2>
                    <p style="color: #6b7280;">Por favor, contacta al administrador para configurar los deliverys.</p>
                </div>
            `;
        }

        // Cerrar modales y men√∫ m√≥vil al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (e.target.id === 'modal-carrito') {
                cerrarModal();
            }
            if (e.target.id === 'modal-login') {
                cerrarLogin();
            }
            if (e.target.id === 'modal-opciones') {
                cerrarModalOpciones();
            }
            
            // Cerrar men√∫ m√≥vil si se hace clic fuera de √©l
            const mobileNavbar = document.getElementById('mobile-navbar');
            const btnMenuMobile = document.getElementById('btn-menu-mobile');
            
            if (mobileNavbar && !mobileNavbar.classList.contains('hidden')) {
                if (!mobileNavbar.contains(e.target) && !btnMenuMobile.contains(e.target)) {
                    mobileNavbar.classList.add('hidden');
                }
            }
        });

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosCompletos();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98050013e4e11499',t:'MTc1ODA3NDMyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
